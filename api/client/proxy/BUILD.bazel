load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")

go_library(
    name = "proxy",
    srcs = ["client.go"],
    importpath = "github.com/gravitational/teleport/api/client/proxy",
    visibility = ["//visibility:public"],
    deps = [
        "//api/breaker",
        "//api/client",
        "//api/client/proxy/transport/transportv1",
        "//api/defaults",
        "//api/gen/proto/go/teleport/transport/v1:transport",
        "//api/metadata",
        "//api/utils/grpc/interceptors",
        "@com_github_gravitational_trace//:trace",
        "@io_opentelemetry_go_contrib_instrumentation_google_golang_org_grpc_otelgrpc//:otelgrpc",
        "@org_golang_google_grpc//:grpc",
        "@org_golang_google_grpc//credentials",
        "@org_golang_google_grpc//credentials/insecure",
        "@org_golang_x_crypto//ssh",
        "@org_golang_x_crypto//ssh/agent",
    ],
)

go_test(
    name = "proxy_test",
    srcs = ["client_test.go"],
    embed = [":proxy"],
    deps = [
        "//api/client",
        "//api/client/proto",
        "//api/gen/proto/go/teleport/transport/v1:transport",
        "//api/trail",
        "//api/utils/grpc/stream",
        "@com_github_google_go_cmp//cmp",
        "@com_github_google_go_cmp//cmp/cmpopts",
        "@com_github_gravitational_trace//:trace",
        "@com_github_stretchr_testify//assert",
        "@com_github_stretchr_testify//require",
        "@org_golang_google_grpc//:grpc",
        "@org_golang_google_grpc//credentials",
        "@org_golang_google_grpc//credentials/insecure",
        "@org_golang_google_grpc//test/bufconn",
        "@org_golang_google_protobuf//testing/protocmp",
        "@org_golang_x_crypto//ssh",
        "@org_golang_x_crypto//ssh/agent",
    ],
)
