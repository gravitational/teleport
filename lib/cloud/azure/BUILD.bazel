load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")

go_library(
    name = "azure",
    srcs = [
        "client_map.go",
        "constants.go",
        "credentials.go",
        "db_server.go",
        "errors.go",
        "interfaces.go",
        "kubernetes.go",
        "mocks.go",
        "mysql.go",
        "mysql_flex.go",
        "postgres.go",
        "postgres_flex.go",
        "redis.go",
        "redis_enterprise.go",
        "roleassignments.go",
        "roledefinitions.go",
        "sql.go",
        "sql_managed.go",
        "subscriptions.go",
        "user_identities.go",
        "vm.go",
    ],
    importpath = "github.com/gravitational/teleport/lib/cloud/azure",
    visibility = ["//visibility:public"],
    deps = [
        "//api/types",
        "//lib/defaults",
        "//lib/fixtures",
        "//lib/utils",
        "@com_github_azure_azure_sdk_for_go_sdk_azcore//:azcore",
        "@com_github_azure_azure_sdk_for_go_sdk_azcore//arm",
        "@com_github_azure_azure_sdk_for_go_sdk_azcore//policy",
        "@com_github_azure_azure_sdk_for_go_sdk_azcore//runtime",
        "@com_github_azure_azure_sdk_for_go_sdk_azcore//to",
        "@com_github_azure_azure_sdk_for_go_sdk_azidentity//:azidentity",
        "@com_github_azure_azure_sdk_for_go_sdk_resourcemanager_authorization_armauthorization_v2//:armauthorization",
        "@com_github_azure_azure_sdk_for_go_sdk_resourcemanager_compute_armcompute_v6//:armcompute",
        "@com_github_azure_azure_sdk_for_go_sdk_resourcemanager_containerservice_armcontainerservice_v6//:armcontainerservice",
        "@com_github_azure_azure_sdk_for_go_sdk_resourcemanager_msi_armmsi//:armmsi",
        "@com_github_azure_azure_sdk_for_go_sdk_resourcemanager_mysql_armmysql//:armmysql",
        "@com_github_azure_azure_sdk_for_go_sdk_resourcemanager_mysql_armmysqlflexibleservers//:armmysqlflexibleservers",
        "@com_github_azure_azure_sdk_for_go_sdk_resourcemanager_postgresql_armpostgresql//:armpostgresql",
        "@com_github_azure_azure_sdk_for_go_sdk_resourcemanager_postgresql_armpostgresqlflexibleservers//:armpostgresqlflexibleservers",
        "@com_github_azure_azure_sdk_for_go_sdk_resourcemanager_redis_armredis_v3//:armredis",
        "@com_github_azure_azure_sdk_for_go_sdk_resourcemanager_redisenterprise_armredisenterprise//:armredisenterprise",
        "@com_github_azure_azure_sdk_for_go_sdk_resourcemanager_sql_armsql//:armsql",
        "@com_github_azure_azure_sdk_for_go_sdk_resourcemanager_subscription_armsubscription//:armsubscription",
        "@com_github_golang_jwt_jwt_v4//:jwt",
        "@com_github_gravitational_trace//:trace",
        "@com_github_jonboulle_clockwork//:clockwork",
        "@io_k8s_api//rbac/v1:rbac",
        "@io_k8s_apimachinery//pkg/api/errors",
        "@io_k8s_apimachinery//pkg/apis/meta/v1:meta",
        "@io_k8s_apimachinery//pkg/util/yaml",
        "@io_k8s_client_go//kubernetes",
        "@io_k8s_client_go//kubernetes/typed/authorization/v1:authorization",
        "@io_k8s_client_go//rest",
        "@io_k8s_client_go//tools/clientcmd",
    ],
)

go_test(
    name = "azure_test",
    srcs = [
        "client_map_test.go",
        "db_server_test.go",
        "kubernetes_test.go",
        "mysql_flex_test.go",
        "redis_enterprise_test.go",
        "redis_test.go",
        "sql_managed_test.go",
        "sql_test.go",
        "subscriptions_test.go",
        "user_identities_test.go",
        "vm_test.go",
    ],
    embed = [":azure"],
    deps = [
        "//api/types",
        "//lib/defaults",
        "@com_github_azure_azure_sdk_for_go_sdk_azcore//:azcore",
        "@com_github_azure_azure_sdk_for_go_sdk_azcore//arm",
        "@com_github_azure_azure_sdk_for_go_sdk_azcore//policy",
        "@com_github_azure_azure_sdk_for_go_sdk_azcore//to",
        "@com_github_azure_azure_sdk_for_go_sdk_azidentity//:azidentity",
        "@com_github_azure_azure_sdk_for_go_sdk_resourcemanager_compute_armcompute_v6//:armcompute",
        "@com_github_azure_azure_sdk_for_go_sdk_resourcemanager_containerservice_armcontainerservice_v6//:armcontainerservice",
        "@com_github_azure_azure_sdk_for_go_sdk_resourcemanager_mysql_armmysql//:armmysql",
        "@com_github_azure_azure_sdk_for_go_sdk_resourcemanager_mysql_armmysqlflexibleservers//:armmysqlflexibleservers",
        "@com_github_azure_azure_sdk_for_go_sdk_resourcemanager_postgresql_armpostgresql//:armpostgresql",
        "@com_github_azure_azure_sdk_for_go_sdk_resourcemanager_redis_armredis_v3//:armredis",
        "@com_github_azure_azure_sdk_for_go_sdk_resourcemanager_redisenterprise_armredisenterprise//:armredisenterprise",
        "@com_github_azure_azure_sdk_for_go_sdk_resourcemanager_sql_armsql//:armsql",
        "@com_github_azure_azure_sdk_for_go_sdk_resourcemanager_subscription_armsubscription//:armsubscription",
        "@com_github_golang_jwt_jwt_v4//:jwt",
        "@com_github_google_go_cmp//cmp",
        "@com_github_gravitational_trace//:trace",
        "@com_github_jonboulle_clockwork//:clockwork",
        "@com_github_stretchr_testify//require",
        "@io_k8s_client_go//kubernetes/typed/authorization/v1:authorization",
        "@io_k8s_client_go//rest",
    ],
)
