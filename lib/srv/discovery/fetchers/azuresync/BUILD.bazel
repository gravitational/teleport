load("@io_bazel_rules_go//go:def.bzl", "go_library", "go_test")

go_library(
    name = "azuresync",
    srcs = [
        "azure-sync.go",
        "memberships.go",
        "principals.go",
        "reconcile.go",
        "roleassignments.go",
        "roledefinitions.go",
        "virtualmachines.go",
    ],
    importpath = "github.com/gravitational/teleport/lib/srv/discovery/fetchers/azuresync",
    visibility = ["//visibility:public"],
    deps = [
        "//api/types",
        "//gen/proto/go/accessgraph/v1alpha",
        "//lib/cloud/azure",
        "//lib/msgraph",
        "//lib/utils/slices",
        "@com_github_azure_azure_sdk_for_go_sdk_azidentity//:azidentity",
        "@com_github_azure_azure_sdk_for_go_sdk_resourcemanager_authorization_armauthorization_v2//:armauthorization",
        "@com_github_azure_azure_sdk_for_go_sdk_resourcemanager_compute_armcompute_v6//:armcompute",
        "@com_github_gravitational_trace//:trace",
        "@org_golang_google_protobuf//proto",
        "@org_golang_google_protobuf//types/known/timestamppb",
        "@org_golang_x_sync//errgroup",
    ],
)

go_test(
    name = "azuresync_test",
    srcs = [
        "azure-sync_test.go",
        "reconcile_test.go",
    ],
    embed = [":azuresync"],
    deps = [
        "//gen/proto/go/accessgraph/v1alpha",
        "@com_github_azure_azure_sdk_for_go_sdk_resourcemanager_authorization_armauthorization_v2//:armauthorization",
        "@com_github_azure_azure_sdk_for_go_sdk_resourcemanager_compute_armcompute_v6//:armcompute",
        "@com_github_stretchr_testify//require",
    ],
)
