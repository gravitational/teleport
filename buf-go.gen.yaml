version: v2

inputs:
  - directory: .
    exclude_paths:
      # generated by buf-gogo.gen.yaml
      - api/proto/teleport/attestation/
      - api/proto/teleport/legacy/
      - api/proto/teleport/mfa/
      - api/proto/teleport/usageevents/
      - proto/teleport/lib/web/terminal/envelope.proto
      # generated by buf-connect-go.gen.yaml
      - proto/prehog/
      - proto/teleport/lib/proxy/peer/v0/
  - directory: .
    paths:
      # excluded by buf-gogo.gen.yaml
      - api/proto/teleport/legacy/client/proto/event.proto

plugins:
  - local:
      - go
      - run
      - google.golang.org/protobuf/cmd/protoc-gen-go
    out: .
    opt:
      - module=github.com/gravitational/teleport
      # needed by teleport/lib/teleterm/v1/usage_events.proto because we use
      # managed mode for the go package name there
      - Mprehog/v1alpha/connect.proto=github.com/gravitational/teleport/gen/proto/go/prehog/v1alpha;prehogv1alpha
    strategy: all
  - local:
      - go
      - run
      - google.golang.org/grpc/cmd/protoc-gen-go-grpc
    out: .
    opt:
      - module=github.com/gravitational/teleport
      # needed by teleport/lib/teleterm/v1/usage_events.proto because we use
      # managed mode for the go package name there
      - Mprehog/v1alpha/connect.proto=github.com/gravitational/teleport/gen/proto/go/prehog/v1alpha;prehogv1alpha
    strategy: all
