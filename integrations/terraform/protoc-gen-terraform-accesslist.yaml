---
target_package_name: "v1"
default_package_name: "github.com/gravitational/teleport/api/gen/proto/go/teleport/accesslist/v1"
duration_custom_type: Duration
use_state_for_unknown_by_default: true

# Top-level type names to export
types:
    - "AccessList"
    - "Member"

# These import paths were not being automatically picked up by
# protoc-gen-terraform without these overrides
import_path_overrides:
    "types": "github.com/gravitational/teleport/api/types"
    "wrappers": "github.com/gravitational/teleport/api/types/wrappers"
    "durationpb": "google.golang.org/protobuf/types/known/durationpb"
    "timestamppb": "google.golang.org/protobuf/types/known/timestamppb"
    "v1": "github.com/gravitational/teleport/api/gen/proto/go/teleport/header/v1"
    "v11": "github.com/gravitational/teleport/api/gen/proto/go/teleport/trait/v1"
    "github_com_gravitational_teleport_integrations_terraform_tfschema": "github.com/gravitational/teleport/integrations/terraform/tfschema"

# id field is required for integration tests. It is not used by provider.
# We have to add it manually (might be removed in the future versions).
injected_fields:
  AccessList:
    -
      name: id
      type: github.com/hashicorp/terraform-plugin-framework/types.StringType
      computed: true
      plan_modifiers:
        - "github.com/hashicorp/terraform-plugin-framework/tfsdk.UseStateForUnknown()"
  Member:
    -
      name: id
      type: github.com/hashicorp/terraform-plugin-framework/types.StringType
      computed: true
      plan_modifiers:
        - "github.com/hashicorp/terraform-plugin-framework/tfsdk.UseStateForUnknown()"

# These fields will be excluded
exclude_fields:
    # Metadata (we id resources by name on our side)
    - "AccessList.header.metadata.id"
    # Read only field
    - "AccessList.spec.owners.ineligible_status"
    - "AccessList.status"
    # Metadata (we id resources by name on our side)
    - "Member.header.metadata.id"
    # Read only field
    - "Member.spec.ineligible_status"

# These fields will be marked as Computed: true
computed_fields:
    - "AccessList.header.kind"
    - "AccessList.header.metadata.expires"
    - "AccessList.header.metadata.namespace"
    - "AccessList.header.metadata.revision"
    - "AccessList.spec.audit.next_audit_date"
    - "Member.header.kind"
    - "Member.header.metadata.expires"
    - "Member.header.metadata.namespace"
    - "Member.header.metadata.revision"
    - "Member.spec.name"
    - "Member.spec.joined"
    - "Member.spec.added_by"

# These fields will be marked as Required: true
required_fields:
    - "Metadata.name"
    - "AccessList.header.version"
    - "AccessList.spec.owners"
    - "Member.header.version"
    - "Member.spec.access_list"
    - "Member.spec.membership_kind"

plan_modifiers:
    # Force to recreate resource if it's ID changes
    Metadata.name:
      - "github.com/hashicorp/terraform-plugin-framework/tfsdk.RequiresReplace()"
    # spec.access_list is a part of access_list_member ID. In the backend member's ID is
    # constructed like:
    # "{access_list_member.spec.access_list}/{access_list_member.header.metadata.name}"
    # So the resource should be recreated if the access_list field changes.
    Member.spec.access_list:
      - "github.com/hashicorp/terraform-plugin-framework/tfsdk.RequiresReplace()"
    # If the membership kind changes, that basically means it's a different member now so it should
    # be replaced.
    Member.spec.membership_kind:
      - "github.com/hashicorp/terraform-plugin-framework/tfsdk.RequiresReplace()"

# This must be defined for the generator to be happy, but in reality all time
# fields are overridden (because the protobuf timestamps contain locks and the
# linter gets mad if we use raw structs instead of pointers).
time_type:
  type: "PlaceholderType"
duration_type:
  type: "PlaceholderType"

validators:
  # Expires must be in the future
  Metadata.expires:
    - github_com_gravitational_teleport_integrations_terraform_tfschema.MustTimeBeInFuture()

custom_types:
  "AccessList.header.metadata.expires": Timestamp
  "AccessList.spec.audit.next_audit_date": Timestamp
  "AccessList.spec.audit.frequency": Duration
  "AccessList.spec.audit.notifications.start": Duration
  "Member.header.metadata.expires": Timestamp
  "Member.spec.joined": Timestamp
  "Member.spec.expires": Timestamp
