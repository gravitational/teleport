---
target_package_name: "v1"
default_package_name: "github.com/gravitational/teleport/api/gen/proto/go/teleport/summarizer/v1"
duration_custom_type: Duration
use_state_for_unknown_by_default: true

# Top-level type names to export
types:
  - "InferenceModel"
  - "InferenceSecret"
  - "InferencePolicy"

# These import paths were not being automatically picked up by
# protoc-gen-terraform without these overrides
import_path_overrides:
  "types": "github.com/gravitational/teleport/api/types"
  "wrappers": "github.com/gravitational/teleport/api/types/wrappers"
  "durationpb": "google.golang.org/protobuf/types/known/durationpb"
  "timestamppb": "google.golang.org/protobuf/types/known/timestamppb"
  "v1": "github.com/gravitational/teleport/api/gen/proto/go/teleport/header/v1"
  "github_com_gravitational_teleport_integrations_terraform_tfschema": "github.com/gravitational/teleport/integrations/terraform/tfschema"

# id field is required for integration tests. It is not used by provider.
# We have to add it manually (might be removed in the future versions).
injected_fields:
  InferenceModel:
    -
      name: id
      type: github.com/hashicorp/terraform-plugin-framework/types.StringType
      computed: true
      plan_modifiers:
        - "github.com/hashicorp/terraform-plugin-framework/tfsdk.UseStateForUnknown()"

  InferenceSecret:
    -
      name: id
      type: github.com/hashicorp/terraform-plugin-framework/types.StringType
      computed: true
      plan_modifiers:
        - "github.com/hashicorp/terraform-plugin-framework/tfsdk.UseStateForUnknown()"

  InferencePolicy:
    -
      name: id
      type: github.com/hashicorp/terraform-plugin-framework/types.StringType
      computed: true
      plan_modifiers:
        - "github.com/hashicorp/terraform-plugin-framework/tfsdk.UseStateForUnknown()"

# These fields will be excluded
exclude_fields:
  # Metadata (we id resources by name on our side)
  - "InferenceModel.metadata.id"
  - "InferenceSecret.metadata.id"
  - "InferencePolicy.metadata.id"

  # Temperature fields need to be excluded because of
  # https://discuss.hashicorp.com/t/terraform-plugin-framework-float64-type-validation-error/48645/4
  # TODO(bl-nero): Remove these if Terraform framework gets updated to 1.2.0 or
  # later.
  - "InferenceModel.spec.openai.temperature"
  - "InferenceModel.spec.bedrock.temperature"

# These fields will be marked as Computed: true
computed_fields:
  - "InferenceModel.kind"
  - "InferenceModel.metadata.expires"
  - "InferenceModel.metadata.namespace"
  - "InferenceModel.metadata.revision"
  - "InferenceSecret.kind"
  - "InferenceSecret.metadata.expires"
  - "InferenceSecret.metadata.namespace"
  - "InferenceSecret.metadata.revision"
  - "InferencePolicy.kind"
  - "InferencePolicy.metadata.expires"
  - "InferencePolicy.metadata.namespace"
  - "InferencePolicy.metadata.revision"

# These fields will be marked as Required: true
required_fields:
  - "InferenceModel.metadata"  
  - "InferenceModel.metadata.name"  
  - "InferenceModel.spec"  
  - "InferenceSecret.metadata"  
  - "InferenceSecret.metadata.name"  
  - "InferenceSecret.spec"  
  - "InferenceSecret.spec.value"  
  - "InferencePolicy.metadata"  
  - "InferencePolicy.metadata.name"  
  - "InferencePolicy.metadata"  
  - "InferencePolicy.metadata.name"  
  - "InferencePolicy.spec"  
  - "InferencePolicy.spec.kinds"  
  - "InferencePolicy.spec.model"  

plan_modifiers:
  # Force to recreate resource if it's name changes
  Metadata.name:
    - "github.com/hashicorp/terraform-plugin-framework/tfsdk.RequiresReplace()"

# This must be defined for the generator to be happy, but in reality all time
# fields are overridden (because the protobuf timestamps contain locks and the
# linter gets mad if we use raw structs instead of pointers).
time_type:
  type: "PlaceholderType"
duration_type:
  type: "PlaceholderType"

validators:
  # Expires must be in the future
  Metadata.expires:
    - github_com_gravitational_teleport_integrations_terraform_tfschema.MustTimeBeInFuture()

custom_types:
  "InferenceModel.metadata.expires": Timestamp
  "InferenceSecret.metadata.expires": Timestamp
  "InferencePolicy.metadata.expires": Timestamp

sensitive_fields:
  - "InferenceSecret.spec"
  - "InferenceSecret.spec.value"
 