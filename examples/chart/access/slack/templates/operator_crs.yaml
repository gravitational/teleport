{{- if .Values.crd.create -}}
{{- if not .Values.tbot.enabled -}}
{{- fail "Custom resources cannot be deployed without tbot enabled" -}}
{{- end -}}
apiVersion: resources.teleport.dev/v1
kind: TeleportBotV1
metadata:
  name: {{ include "slack.fullname" . }}
  namespace: {{ include "slack.crd.namespace" . }}
  labels:
    {{- include "slack.labels" . | nindent 4 }}
spec:
  roles:
    - access-plugin
---
apiVersion: resources.teleport.dev/v2
kind: TeleportProvisionToken
metadata:
  name: {{ include "slack.tbot.tokenName" . }}
  namespace: {{ include "slack.crd.namespace" . }}
  labels:
    {{- include "slack.labels" . | nindent 4 }}
spec:
  roles: [Bot]
  bot_name: {{ include "slack.fullname" . }}
  {{- include "slack.crd.tokenJoinSpec" . | nindent 2 -}}
{{- end -}}
