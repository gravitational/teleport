suite: Test ServiceAccount
templates:
  - serviceaccount.yaml

tests:
  - it: creates a service account by default
    asserts:
      - hasDocuments:
          count: 1
      - containsDocument:
          kind: ServiceAccount
          apiVersion: v1
          name: RELEASE-NAME-teleport-relay
  - it: does not create a service account if serviceAccount.create is false
    set:
      serviceAccount:
        create: false
    asserts:
      - hasDocuments:
          count: 0
  - it: creates a service account with the configured name
    set:
      serviceAccount:
        name: randomServiceAccountName
    asserts:
      - equal:
          path: metadata.name
          value: randomServiceAccountName
  - it: includes extraLabels and annotations
    set:
      extraLabels:
        serviceAccount:
          labelName1: labelValue1
          labelName2: labelValue2
      annotations:
        serviceAccount:
          annotationName1: annotationValue1
          annotationName2: annotationValue2
    asserts:
      - isSubset:
          path: metadata.labels
          content:
            labelName1: labelValue1
            labelName2: labelValue2
      - equal:
          path: metadata.annotations
          value:
            annotationName1: annotationValue1
            annotationName2: annotationValue2
