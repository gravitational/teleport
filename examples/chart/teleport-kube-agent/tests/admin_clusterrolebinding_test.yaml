suite: AdminClusterRoleBinding
templates:
  - admin_clusterrolebinding.yaml
tests:
  - it: don't generate a admin cluster role binding when rbac.create is false
    set:
      rbac:
        create: false
    asserts:
      - hasDocuments:
          count: 0
  - it: generate a admin cluster role binding when rbac.create is true
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: ClusterRoleBinding
      - equal:
          path: subjects[0].name
          value: RELEASE-NAME-cluster-admin
      - matchSnapshot: {}
  - it: generate a admin cluster role binding when rbac.create is true and rbac.adminClusterRoleBindingName is set
    set:
      rbac:
        create: true
        adminClusterRoleBindingName: my-cluster-admin
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: ClusterRoleBinding
      - equal:
          path: metadata.name
          value: my-cluster-admin
      - matchSnapshot: {}
  - it: generate a admin cluster role binding when rbac.create is true and rbac.adminGroupName is set
    set:
      rbac:
        create: true
        adminGroupName: my-cluster-admin-group
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: ClusterRoleBinding
      - equal:
          path: subjects[0].name
          value: my-cluster-admin-group
      - matchSnapshot: {}
