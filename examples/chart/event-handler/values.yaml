# Default values for event-handler.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

#
# Plugin specific options
#

# teleport -- contains the configuration describing how the plugin connects to
# your Teleport cluster.
teleport:
  # teleport.address(string) -- is the address of the Teleport cluster the plugin
  # connects to. The address must contain both the domain name and the port of
  # the Teleport cluster. It can be either the address of the auth servers or the
  # proxy servers.
  #
  # For example:
  #   - joining a Proxy: `teleport.example.com:443` or `teleport.example.com:3080`
  #   - joining an Auth: `teleport-auth.example.com:3025`
  #
  # When the address is empty, `tbot.teleportProxyAddress`
  # or `tbot.teleportAuthAddress` will be used if they are set.
  address: ""
  # teleport.identitySecretName(string) -- is the name of the Kubernetes secret
  # that contains the credentials for the connection to your Teleport cluster.
  #
  # The secret should be in the following format:
  #
  # ```yaml
  # apiVersion: v1
  # kind: Secret
  # type: Opaque
  # metadata:
  #   name: teleport-plugin-event-handler-identity
  # data:
  #   auth_id: #...
  # ```
  #
  # Check out the [Export Events with Fluentd]
  # (../../zero-trust-access/export-audit-events/fluentd.mdx) guide
  # for more information about how to acquire these credentials.
  identitySecretName: ""
  # teleport.identitySecretPath(string) -- is the key in the Kubernetes secret
  # specified by `teleport.identitySecretName` that holds the credentials for
  # the connection to your Teleport cluster. If the secret has the path,
  # `"auth_id"`, you can omit this field.
  identitySecretPath: "auth_id"

# eventHandler -- contains the configuration used by the plugin to forward Teleport events.
eventHandler:
  # eventHandler.storagePath(string) -- is the storage directory for the event handler.
  storagePath: "/var/lib/teleport/plugins/event-handler/storage"
  # eventHandler.timeout(string) -- is the polling timeout.
  timeout: "10s"
  # eventHandler.batch(int) -- is the fetch batch size.
  batch: 20
  # eventHandler.windowSize(string) -- configures the duration of the time window for the event handler
  # to request events from Teleport. By default, this is set to 24 hours.
  # Reduce the window size if the events backend cannot manage the event volume
  # for the default window size.
  # The window size should be specified as a duration string, parsed by Go's time.ParseDuration.
  windowSize: "24h"
  # eventHandler.debug(bool) -- enables debug logging.
  debug: false
  # eventHandler.types(list) -- is the list of event types to forward.
  # When unset, the event handler forwards all events.
  types: []
  # eventHandler.skipEventTypes(list) -- is the list of audit event types to skip.
  skipEventTypes: []
  # eventHandler.skipSessionTypes(list) -- is the list of session recording event types to skip.
  # When unset, the event handler skips noisy and binary events.
  #
  # See the [Teleport-event-handler README](https://github.com/gravitational/teleport/blob/1d2bd5eb8fc3500deb7d7108f6835efde98b7b24/integrations/event-handler/README.md)
  # for a list of default skipped events.
  skipSessionTypes: []
  # eventHandler.startTime(string) -- is the start time to start ingestion from (RFC3339 format).
  startTime: ""
  # eventHandler.dryRun(bool) -- enables dry run without sending events to fluentd.
  dryRun: false
  # eventHandler.concurrency(int) -- is the number of concurrent sessions to process. By default, this is set to 5.
  concurrency: 5
  lock:
    # eventHandler.lock.enabled(bool) -- controls whether user auto-locking is enabled.
    enabled: false
    # eventHandler.lock.failedAttemptsCount(int) -- is the number of failed attempts in the `lockPeriod` which
    # triggers locking. By default, this is set to 3.
    failedAttemptsCount: 3
    # eventHandler.lock.period(string) -- is the time period where `lock-failed-attempts-count` failed attempts
    # will trigger locking. By default, this is set to 1 minute.
    period: "1m"
    # eventHandler.lock.for(string) -- is the time period for which user gets lock.
    for: ""

# fluentd -- contains the configuration for the fluentd forwarder.
fluentd:
  # fluentd.url(string) -- is the Fluentd URL where the events will be sent.
  url: ""
  # fluentd.sessionUrl(string) -- is the Fluentd URL where the session logs will be sent.
  sessionUrl: ""
  certificate:
    # fluentd.certificate.secretName(string) -- is the secret containing the credentials to connect to Fluentd.
    # It must contain the CA certificate, the client key and the client certificate.
    secretName: ""
    # fluentd.certificate.caPath(string) -- is the name of the key which contains the CA certificate inside the secret.
    caPath: "ca.crt"
    # fluentd.certificate.certPath(string) -- is the name of the key which contains the client's certificate inside the secret.
    certPath: "client.crt"
    # fluentd.certificate.keyPath(string) -- is the name of the key which contains the client's private key inside the secret.
    keyPath: "client.key"
  # fluentd.maxConnections(int) -- is the maximum number of connections to Fluentd. By default, or when set to 0,
  # this becomes `eventHandler.concurrency` * 2.
  maxConnections: 0

# tbot -- controls the optional tbot deployment that obtains and renews
# credentials for the plugin to connect to Teleport.
# Only default and mandatory values are described here, see the tbot chart reference
# for the full list of supported values.
tbot:
  # tbot.enabled(bool) -- controls if tbot should be deployed with the event handler plugin.
  enabled: false
  # tbot.clusterName(string) -- is the name of the Teleport cluster tbot and the event handler plugin will join.
  # Setting this value is mandatory when tbot is enabled.
  clusterName: ""
  # tbot.teleportProxyAddress(string) -- is the teleport Proxy Service address the bot will connect to.
  # This must contain the port number, usually 443 or 3080 for Proxy Service.
  # Connecting to the Proxy Service is the most common and recommended way to connect to Teleport.
  # This is mandatory to connect to Teleport Enterprise (Cloud).
  #
  # This setting is mutually exclusive with `teleportAuthAddress`.
  #
  # For example:
  # ```yaml
  # tbot:
  #   teleportProxyAddress: "test.teleport.sh:443"
  # ```
  teleportProxyAddress: ""
  # tbot.teleportAuthAddress(string) -- is the teleport Auth Service address the bot will connect to.
  # This must contain the port number, usually 3025 for Auth Service. Direct Auth Service connection
  # should be used when you are deploying the bot in the same Kubernetes cluster than your `teleport-cluster`
  # Helm release and have direct access to the Auth Service.
  # Else, you should prefer connecting via the Proxy Service.
  #
  # This setting is mutually exclusive with `teleportProxyAddress`.
  #
  # For example:
  # ```yaml
  # teleportAuthAddress: "teleport-auth.teleport-namespace.svc.cluster.local:3025"
  # ```
  teleportAuthAddress: ""

  # tbot.joinMethod(string) -- describes how tbot joins the Teleport cluster.
  # See [the join method reference](../../reference/deployment/join-methods.mdx) for a list of supported values and detailed explanations.
  joinMethod: "kubernetes"
  # tbot.token(string) -- is the name of the token used by tbot to join the Teleport cluster.
  # This value is not sensitive unless the `joinMethod` is set to `"token"`.
  # If unset, defaults to `[release name]-tbot`.
  # If `crd.create` is set to true, then a TeleportProvisionToken will be created with the provided token name.
  token: ""

  # Don't touch the tbot values below, this will break the chart.
  # This ensures that tbot.fullname is not shortened if the release name contains "tbot"
  nameOverride: tbot
  defaultOutput:
    enabled: true

# crd -- controls whether the chart creates custom resources managed by the Teleport Kubernetes Operator.
# If enabled, the chart will create TeleportRoleV8, TeleportBotV1, and TeleportProvisionToken
# resources to automatically connect the plugin to Teleport.
#
# <Admonition type="warning" title="Interaction with Teleport Kubernetes Operator">
# The Teleport Kubernetes Operator must already be enabled in the Teleport cluster
# for the custom resources to be applied successfully. In addition,
# the custom resources must be deployed in the same namespace as the Teleport Kubernetes Operator.
# </Admonition>
crd:
  # crd.create(bool) -- controls if the chart should create
  # the Operator custom resources to automatically bootstrap the plugin.
  create: false
  # crd.namespace(string) -- optionally overrides the Kubernetes namespace that the
  # custom resources are created in. This should match the namespace in which the
  # Teleport Kubernetes Operator is running. Defaults to the release namespace.
  namespace: ""
  # crd.tokenSpecOverride -- optionally overrides the join token spec for tbot to use to join the Teleport cluster.
  #
  # When tbot is enabled, the default configuration uses the `kubernetes` in_cluster join method.
  # By default, the service account for tbot will be allowed for all `kubernetes` join types: in_cluster, JWKS, OIDC.
  #
  # You can also configure the token to use other supported join methods. The token specification
  # must match `tbot.joinMethod` for the plugin to correctly join the cluster.
  # See [the join method reference](../../reference/deployment/join-methods.mdx) for a list of supported values and detailed explanations.
  #
  # <Admonition type="warning" title="Other Join Methods">
  # When not using the `kubernetes` join method, or when tbot is not enabled, you must specify `join_method`.
  # Ensure all necessary fields for the join token are present for the Operator
  # to correctly create the Teleport token resource.
  # </Admonition>
  #
  # Example (Kubernetes JWKS join method):
  # ```yaml
  # tokenSpecOverride:
  #   join_method: kubernetes
  #   kubernetes:
  #     type: static_jwks
  #     static_jwks:
  #       jwks: |
  #         # Place the kubernetes JWKS here (`kubectl get --raw /openid/v1/jwks`)
  #         {"keys":[--snip--]}
  # ```
  #
  # Example (Kubernetes OIDC join method):
  # ```yaml
  # tokenSpecOverride:
  #   join_method: kubernetes
  #   kubernetes:
  #     type: oidc
  #     oidc:
  #       # Insert the OIDC issuer value here, it will vary depending on your
  #       # cluster and cloud provider.
  #       issuer: https://oidc.eks.us-west-2.amazonaws.com/id/my-cluster
  # ```
  tokenSpecOverride: {}

persistentVolumeClaim:
  enabled: false
  size: 1Gi
  storageClassName: ""
  existingClaim: ""
  volumeName: "storage"

# annotations -- contains annotations to apply to the different Kubernetes
# objects created by the chart. See [the Kubernetes annotation
# documentation](https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/)
# for more details.
annotations:
  # annotations.config(object) -- are annotations to set on the ConfigMap.
  config: {}
  # annotations.deployment(object) -- are annotations to set on the Deployment.
  deployment: {}
  # annotations.pod(object) -- are annotations to set on the Pods.
  pod: {}
  
# extraLabels -- contains additional Kubernetes labels to apply on the resources
# created by the chart. See [the Kubernetes label documentation
# ](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/)
# for more information.
extraLabels:
  # extraLabels.config(object) -- are labels to set on the ConfigMap.
  config: {}
  # extraLabels.deployment(object) -- are labels to set on the Deployment.
  deployment: {}
  # extraLabels.pod(object) -- are labels to set on the Pods.
  pod: {}

#
# Deployment
#
# image -- sets the container image used for plugin pods created by the chart.
#
# You can override this to use your own plugin image rather than a Teleport-published image.
image:
  # image.repository(string) -- is the image repository.
  repository: public.ecr.aws/gravitational/teleport-plugin-event-handler
  # image.pullPolicy(string) -- is the [Kubernetes image pull policy](https://kubernetes.io/docs/concepts/containers/images/#image-pull-policy).
  pullPolicy: IfNotPresent
  # image.tag(string) -- Overrides the image tag whose default is the chart appVersion.
  #
  # Normally, the version of the Teleport plugin matches the
  # version of the chart. If you install chart version 15.0.0, you'll use
  # the plugin version 15.0.0. Upgrading the plugin is done by upgrading the chart.
  #
  # <Admonition type="warning">
  # `image.tag` is intended for development and custom tags. This MUST NOT be
  # used to control the plugin version in a typical deployment. This
  # chart is designed to run a specific plugin version. You will face
  # compatibility issues trying to run a different version with it.
  #
  # If you want to run the Teleport plugin version `X.Y.Z`, you should use
  # `helm install --version X.Y.Z` instead.
  # </Admonition>
  tag: ""

# imagePullSecrets(list) -- is a list of secrets containing authorization tokens
# which can be optionally used to access a private Docker registry.
#
# See the [Kubernetes reference](https://kubernetes.io/docs/concepts/containers/images/#specifying-imagepullsecrets-on-a-pod) for more details.
imagePullSecrets: []

# nameOverride(string) -- optionally overrides the name of the chart, used
# together with the release name when giving a name to resources.
nameOverride: ""
# fullnameOverride(string) -- optionally overrides the full name of resources.
fullnameOverride: ""

# Deprecated way to set pod annotations. `annotations.pod` should be preferred.
podAnnotations: {}

# podSecurityContext(object) -- sets the pod security context for any pods created by the chart.
# See [the Kubernetes documentation](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-the-security-context-for-a-pod)
# for more details.
#
# To unset the security context, set it to `null` or `~`.
podSecurityContext: {}

# securityContext(object) -- sets the container security context for any pods created by the chart.
# See [the Kubernetes documentation](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/#set-the-security-context-for-a-container)
# for more details.
#
# To unset the security context, set it to `null` or `~`.
securityContext: {}

# resources(object) -- sets the resource requests/limits for any pods created by the chart.
# See [the Kubernetes documentation](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/)
# for more details.
resources: {}

# nodeSelector(object) -- sets the node selector for any pods created by the chart.
# See [the Kubernetes documentation](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#nodeselector)
# for more details.
nodeSelector: {}

# tls -- contains settings for mounting your own TLS material in the event-handler pod.
# The event-handler does not expose a TLS server, so this is only used to trust CAs.
tls:
  # tls.existingCASecretName(string) -- sets the `SSL_CERT_FILE` environment
  # variable to load a trusted CA or bundle in PEM format into Teleport pods.
  # The injected CA will be used to validate TLS communications with the Proxy
  # Service.
  #
  # You must create a secret containing the CA certs in the same namespace as Teleport using a command like:
  #
  # ```code
  # $ kubectl create secret generic my-root-ca --from-file=ca.pem=/path/to/root-ca.pem
  # ```
  existingCASecretName: ""
  # tls.existingCASecretKeyName(string) -- determines which key in the CA secret
  # will be used as a trusted CA bundle file.
  existingCASecretKeyName: "ca.pem"

# tolerations(list) -- sets the tolerations for any pods created by the chart.
# See [the Kubernetes documentation](https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/)
# for more details.
tolerations: []

# affinity(object) -- sets the affinities for any pods created by the chart.
# See [the Kubernetes documentation](https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity)
# for more details.
affinity: {}

# volumes(list) -- sets the volumes mounted into the main event-handler pod.
# See [the Kubernetes volume
# documentation](https://kubernetes.io/docs/concepts/storage/volumes/) for more
# details.
#
# For example:
# ```yaml
# - name: storage
#   persistentVolumeClaim:
#     claimName: teleport-plugin-event-handler
# ```
volumes: []

# volumeMounts(list) -- sets the volume mounts for the main event-handler container.
# See [the Kubernetes volume
# documentation](https://kubernetes.io/docs/concepts/storage/volumes/) for more
# details.
#
# For example:
# ```yaml
# - name: storage
#   mountPath: "/var/lib/teleport/plugins/event-handler/storage"
# ```
volumeMounts: []

# extraArgs(list) -- contains extra arguments to pass to `teleport-plugin start` for
# the main event-handler container.
extraArgs: []

# extraEnv(list) -- contains extra environment variables to set in the main
# event-handler container.
#
# For example:
# ```yaml
# extraEnv:
#   - name: HTTPS_PROXY
#     value: "http://username:password@my.proxy.host:3128"
# ```
extraEnv: []
