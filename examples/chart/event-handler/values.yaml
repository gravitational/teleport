# Default values for event-handler.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

#
# Plugin specific options
#

# teleport -- contains the configuration describing how the plugin connects to
# your Teleport cluster.
teleport:
  # teleport.address(string) -- is the address of the Teleport cluster the plugin
  # connects to. The address must contain both the domain name and the port of
  # the Teleport cluster. It can be either the address of the auth servers or the
  # proxy servers.
  #
  # For example:
  #   - joining a Proxy: `teleport.example.com:443` or `teleport.example.com:3080`
  #   - joining an Auth: `teleport-auth.example.com:3025`
  #
  # When the address is empty, `tbot.teleportProxyAddress`
  # or `tbot.teleportAuthAddress` will be used if they are set.
  address: ""
  # teleport.identitySecretName(string) -- is the name of the Kubernetes secret
  # that contains the credentials for the connection to your Teleport cluster.
  #
  # The secret should be in the following format:
  #
  # ```yaml
  # apiVersion: v1
  # kind: Secret
  # type: Opaque
  # metadata:
  #   name: teleport-plugin-event-handeler-identity
  # data:
  #   auth_id: #...
  # ```
  #
  # Check out the [Export Events with Fluentd]
  # (../../zero-trust-access/export-audit-events/fluentd.mdx) guide
  # for more information about how to acquire these credentials.
  identitySecretName: ""
  # teleport.identitySecretPath(string) -- is the key in the Kubernetes secret
  # specified by `teleport.identitySecretName` that holds the credentials for
  # the connection to your Teleport cluster. If the secret has the path,
  # `"auth_id"`, you can omit this field.
  identitySecretPath: "auth_id"

# eventHandler -- contains the configuration used by the plugin to forward Teleport events.
eventHandler:
  # eventHandler.storagePath(string) -- is the storage directory for the event handler.
  storagePath: "/var/lib/teleport/plugins/event-handler/storage"
  # eventHandler.timeout(string) -- is the polling timeout.
  timeout: "10s"
  # eventHandler.batch(int) -- is the fetch batch size.
  batch: 20
  # eventHandler.windowSize(string) -- configures the duration of the time window for the event handler
  # to request events from Teleport. By default, this is set to 24 hours.
  # Reduce the window size if the events backend cannot manage the event volume
  # for the default window size.
  # The window size should be specified as a duration string, parsed by Go's time.ParseDuration.
  windowSize: "24h"
  # eventHandler.debug(bool) -- enables debug logging.
  debug: false
  # eventHandler.types(list) -- is the list of event types to forward.
  # When unset, the event handler forwards all events.
  types: []
  # eventHandler.skipEventTypes(list) -- is the list of audit event types to skip.
  skipEventTypes: []
  # eventHandler.skipSessionTypes(list) -- is the list of session recording event types to skip.
  # When unset, the event handler skips spammy and binary events.
  #
  # See the [Teleport-event-handler README](https://github.com/gravitational/teleport/blob/1d2bd5eb8fc3500deb7d7108f6835efde98b7b24/integrations/event-handler/README.md)
  # for a list of default skipped events.
  skipSessionTypes: []
  # eventHandler.startTime(string) -- is the start time to start ingestion from (RFC3339 format).
  startTime: ""
  # eventHandler.dryRun(bool) -- enables dry run without sending events to fluentd.
  dryRun: false
  # eventHandler.concurrency(int) -- is the number of concurent sessions to process. By default, this is set to 5.
  concurrency: 5
  lock:
    # eventHandler.lock.enabled(bool) -- controls whether user auto-locking is enabled.
    enabled: false
    # eventHandler.lock.failedAttemptsCount(int) -- is the number of failed attempts in the `lockPeriod` which
    # triggers locking. By default, this is set to 3.
    failedAttemptsCount: 3
    # eventHandler.lock.period(string) -- is the time period where `lock-failed-attempts-count` failed attempts
    # will trigger locking. By default, this is set to 1 minute.
    period: "1m"
    # eventHandler.lock.for(string) -- is the time period for which user gets lock.
    for: ""

# fluentd -- contains the configuration for the fluentd forwarder.
fluentd:
  # fluentd.url(string) -- is the Fluentd URL where the events will be sent.
  url: ""
  # fluentd.sessionUrl(string) -- is the Fluentd URL where the session logs will be sent.
  sessionUrl: ""
  certificate:
    # fluentd.certificate.secretName(string) -- is the secret containing the credentials to connect to Fluentd.
    # It must to contain the CA certificate, the client key and the client certificate.
    secretName: ""
    # fluentd.certificate.caPath(string) -- is the name of the key which contains the CA certificate inside the secret.
    caPath: "ca.crt"
    # fluentd.certificate.certPath(string) -- is the name of the key which contains the client's certificate inside the secret.
    certPath: "client.crt"
    # fluentd.certificate.keyPath(string) -- is the name of the key which contains the client's private key inside the secret.
    keyPath: "client.key"
  # fluentd.maxConnections(int) -- is the maximum number of connections to Fluentd. By default, or when set to 0,
  # this becomes `eventHandler.concurrency` * 2.
  maxConnections: 0

# tbot -- controls the optional tbot deployment that obtains and renews
# credentials for the plugin to connect to Teleport.
# Only default and mandatory values are described here, see the tbot chart reference
# for the full list of supported values.
tbot:
  # tbot.enabled(bool) -- controls if tbot should be deployed with the event handler plugin.
  enabled: false
  # tbot.clusterName(string) -- is the name of the Teleport cluster tbot and the event handler plugin will join.
  # Setting this value is mandatory when tbot is enabled.
  clusterName: ""
  # tbot.teleportProxyAddress(string) -- is the teleport Proxy Service address the bot will connect to.
  # This must contain the port number, usually 443 or 3080 for Proxy Service.
  # Connecting to the Proxy Service is the most common and recommended way to connect to Teleport.
  # This is mandatory to connect to Teleport Enterprise (Cloud).
  #
  # This setting is mutually exclusive with `teleportAuthAddress`.
  #
  # For example:
  # ```yaml
  # tbot:
  #   teleportProxyAddress: "test.teleport.sh:443"
  # ```
  teleportProxyAddress: ""
  # tbot.teleportAuthAddress(string) -- is the teleport Auth Service address the bot will connect to.
  # This must contain the port number, usually 3025 for Auth Service. Direct Auth Service connection
  # should be used when you are deploying the bot in the same Kubernetes cluster than your `teleport-cluster`
  # Helm release and have direct access to the Auth Service.
  # Else, you should prefer connecting via the Proxy Service.
  #
  # This setting is mutually exclusive with `teleportProxyAddress`.
  #
  # For example:
  # ```yaml
  # teleportAuthAddress: "teleport-auth.teleport-namespace.svc.cluster.local:3025"
  # ```
  teleportAuthAddress: ""

  # tbot.joinMethod(string) -- describes how tbot joins the Teleport cluster.
  # See [the join method reference](../../reference/deployment/join-methods.mdx) for a list fo supported values and detailed explanations.
  joinMethod: "kubernetes"
  token: ""

  # Don't touch the tbot values below, this will break the chart.
  # This ensures that tbot.fullname is not shortened if the release name contains "tbot"
  nameOverride: tbot
  defaultOutput:
    enabled: true

persistentVolumeClaim:
  enabled: false
  size: 1Gi
  storageClassName: ""
  existingClaim: ""
  volumeName: "storage"

#
# Deployment
#
image:
  repository: public.ecr.aws/gravitational/teleport-plugin-event-handler
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

podAnnotations: {}

podSecurityContext: {}

securityContext: {}

resources: {}

nodeSelector: {}

# tls -- contains settings for mounting your own TLS material in the event-handler pod.
# The event-handler does not expose a TLS server, so this is only used to trust CAs.
tls:
  # tls.existingCASecretName(string) -- sets the `SSL_CERT_FILE` environment
  # variable to load a trusted CA or bundle in PEM format into Teleport pods.
  # The injected CA will be used to validate TLS communications with the Proxy
  # Service.
  #
  # You must create a secret containing the CA certs in the same namespace as Teleport using a command like:
  #
  # $ kubectl create secret generic my-root-ca --from-file=ca.pem=/path/to/root-ca.pem
  #
  #   The key containing the root CA in the secret must be `ca.pem`.
  existingCASecretName: ""

tolerations: []

affinity: {}

volumes: []
  # - name: storage
  #   persistentVolumeClaim:
  #     claimName: teleport-plugin-event-handler

volumeMounts: []
  # - name: storage
  #   mountPath: "/var/lib/teleport/plugins/event-handler/storage"
