---
title: Installing Teleport on Amazon ECS using Terraform
description: How to install and run Teleport agents on Amazon ECS
labels:
 - platform-wide
 - reference
---

Using Amazon ECS and Terraform allows you to easily deploy and manage Teleport Agents that are closer to your AWS resources.

This flow is ideal when you want to auto discover and secure access to your EKS clusters, RDS databases or other supported AWS resources.

## How it works
Amazon ECS provides a convenient way to deploy Teleport agents closely located to your AWS resources, allowing access even if they are not publicly accessible.
With Terraform, you can easily deploy and keep the Teleport agent up to date.

## Prerequisites
The following set up is required:
- install [`terraform`](https://developer.hashicorp.com/terraform/install)
- [configure AWS credentials](https://registry.terraform.io/providers/hashicorp/aws/latest/docs#authentication-and-configuration)
- a Teleport [IAM Join Token](../reference/join-methods.mdx#aws-iam-role-iam) so that your agent can securely join the Teleport cluster

## Step 1/3. Download the terraform module

Download the source code for our example:
```code
$ git clone https://github.com/gravitational/teleport -b branch/v(=teleport.major_version=)
$ cd teleport/examples/aws/terraform/ecs-agent
```

## Step 2/3. Configure the deployment
The file `variables.tf` contains all the configurable parameters for the Teleport agent deployment, ensure you review and create a `.tfvars` file that overrides the default values.

Here's an example of what a `.tfvars` file might look like:
```hcl
teleport_proxy_server = "proxy.example.com:443"

// AWS Region where the Teleport agent is deployed
aws_region = "eu-south-2"

// ECS cluster name to use.
ecs_cluster = "marco-ecs-guide"

// ECS Service networking configuration.
teleport_agent_subnets         = ["subnet-123"]
teleport_agent_security_groups = ["sg-456"]

// Default tags to add to AWS resources when creating them.
default_tags = {
  "DeployedBy" = "TeleportAmazonECSGuide"
}

// Teleport Agent configuration.
teleport_agent_config = {
  version = "v3"
  teleport = {
    join_params = {
      // Create a new IAM Join Token that allows joining from your AWS Account.
      token_name = "token-ecs-guide"
      method     = "iam"
    }
    // Teleport Proxy server endpoint.
    proxy_server = "proxy.example.com:443"
    log = {
      severity = "DEBUG"
    }
  }
  auth_service = {
    enabled = "no"
  }
  proxy_service = {
    enabled = "no"
  }
  ssh_service = {
    enabled = "yes"
  }
}

// Depending on your use case, you may want to allow additional permissions for the IAM Role which will be assumed by the agent.
ecs_taskrole = "ecs-guide-teleport_agent_role"
ecs_taskrole_policy = {
  Version = "2012-10-17"
  Statement = [
    {
      Action = [
        "sts:GetCallerIdentity",
      ]
      Effect   = "Allow"
      Resource = "*"
    },
  ]
}
ecs_executionrole = "ecs-guide-teleport_agent_executionrole"
```

It configures the following AWS resources:
- IAM Role with the required permission for accessing AWS APIs
- IAM Role to allow log stream of the teleport agent into CloudWatch
- ECS Task Definition which runs a Teleport Agent
- ECS Cluster and an ECS Service which runs the Task Definition above

You should edit the `teleport_agent_config` and `ecs_taskrole_policy` variables and adapt it to your needs.

Save the `.tfvars` file as `my-deployment.tfvars` and use it in the next step.

## Step 3/3. Initialize and apply the Terraform configuration
Applying the configuration will create the resources and deploy the Teleport agent.

```bash
$ terraform init
$ terraform apply -var-file=my-deployment.tfvars
```

After deployment, the agent should be part of your Teleport cluster.

<Admonition type="note" title="Keep your agent up to date">
  Run `terraform apply ...` regularly to ensure the deployed teleport agent version is updated.
</Admonition>

## Troubleshooting

Navigate to the Amazon ECS console, select the Cluster and Service, and look for the logs tab which are stored in CloudWatch.

## Next Steps
Use this guide as a starting point for implementing Auto Discovery for AWS resources:
- [for EKS clusters](../enroll-resources/auto-discovery/kubernetes/aws.mdx)
- [for AWS databases](../enroll-resources/database-access/enroll-aws-databases/)