### "binary missing signature or entitlements" on `tsh device enroll`

A signed and notarized `tsh` binary is necessary to enroll and use a a trusted
device. [Download the macOS tsh installer](../../installation.mdx#macos) to fix
the problem.

### "unauthorized device" errors using a trusted device

A trusted device needs to be registered and enrolled before it is recognized by
Teleport as such. Follow the [registration](../../admin-guides/access-controls/device-trust/device-management.mdx) and
[enrollment](../../admin-guides/access-controls/device-trust/device-management.mdx) steps
and make sure to `tsh logout` and `tsh login` after enrollment is done.

### "Failed to open the TPM device" on Linux

Linux users need permissions to read and write from the TPM device, `/dev/tpmrm0`.
Without such permissions `tsh` would need `sudo` prompts for most operations.

The simplest way to solve this is to check if your distro ships with the `tss`
group and assign it to your OS user. If that is not possible, or you are looking
for a different solution, we recommend creating udev rules similar to the ones
shipped by the [TPM2 Software Stack](
https://github.com/tpm2-software/tpm2-tss/blob/ede63dd1ac1f0a46029d457304edcac2162bfab8/dist/tpm-udev.rules#L4).

### Auto enrollment not working

Auto-enrollment ceremonies, due to their automated nature, are stricter than
regular enrollment. Additional auto-enrollment checks include:

1. Verifying device profile data, such as data originated from Jamf, against the
   actual device
2. Verifying that the device is not enrolled by another user (auto-enroll cannot
   take devices that are already enrolled)

Check you audit log for clues: look for failed "Device Enroll Token Created"
events and see the "message" field in the details (auto-enroll audit log details
available since Teleport v15.4.21).

If you suspect (1) is the issue, compare the actual device against its inventory
definition (`tsh device collect` executed in the actual device vs `tctl get
device/<asset_tag>`). Tweaking the device profile, manual enrollment or waiting
for the next MDM sync may solve the issue.

If you suspect (2), you can unenroll the device using `tctl edit
device/<asset_tag>` and changing the "enroll_status" field to "not_enrolled".

### App access and "access to this app requires a trusted device"

A Teleport admin configured the particular app you are trying to access to
require a trusted device.

There are a few situations that might cause the error:

1. You are trying to access the app using the Web UI.

2. You are trying to access the app using an untrusted device.

The Web UI is currently not capable of device authentication. To access apps
protected by device trust you need to use one of the tsh commands described by
[App Access support](../../admin-guides/access-controls/device-trust/enforcing-device-trust.mdx).
For example, for an app called `myapp`, run `tsh proxy app myapp -p 8888`, then
open http://localhost:8888 in your browser.

If you are already running `tsh proxy app`, or using the certificates acquired
from `tsh app login`, then it's likely your device isn't registered or enrolled.
In this case, follow the advice from the [unauthorized device section](
#unauthorized-device-errors-using-a-trusted-device) above.

