{{ plugin="plugin" }}

### Generate credentials for the Event Handler plugin

In the generated configuration file `{{ plugin }}-values.yaml`,
replace the `teleport` section with the `crd` and `tbot` sections.
Assign <Var name="operator-namespace" /> to the namespace where the
Teleport Kubernetes Operator is running in.
Assign <Var name="teleport.example.com:443" /> to the DNS name and
port of your Teleport Proxy Service:

```yaml
# values.yaml
crd:
  create: true
  namespace: <Var name="operator-namespace" />
  tokenSpecOverride: {}

tbot:
  enabled: true
  clusterName: <Var name="teleport.example.com" />
  teleportProxyAddress: <Var name="teleport.example.com:443" />
```

<Admonition type="warning">
Ensure the `teleport` section is removed, since `tbot` is performing the authentication to the cluster.
</Admonition>

This will generate the Event Handler role and bot user for the Machine & Workload Identity bot, `tbot`,
to authenticate as when connecting to your Teleport cluster.

### Specifying a join method for tbot

The `tbot` deployment authenticates to the Teleport cluster using a `TeleportProvisionToken` custom resource.
By default, the chart configures the `TeleportProvisionToken` custom resource to the `kubernetes`
in_cluster join method.

Optionally, you can override the token specification for other join methods
using the `crd.tokenSpecOverride` field.

<details>
<summary>Example (Kubernetes JWKS join method)</summary>
You can override the TeleportProvisionToken specification to use the `kubernetes` JWKS join method.

```yaml
# values.yaml
tokenSpecOverride:
  join_method: kubernetes
  kubernetes:
    type: static_jwks
    static_jwks:
      jwks: |
        # Place the kubernetes JWKS here (`kubectl get --raw /openid/v1/jwks`)
        {"keys":[--snip--]}
```
</details>

<details>
<summary>Example (Kubernetes OIDC join method)</summary>
You can override the TeleportProvisionToken specification to use the `kubernetes` OIDC join method.

```yaml
# values.yaml
tokenSpecOverride:
  join_method: kubernetes
  kubernetes:
    type: oidc
    oidc:
      # Insert the OIDC issuer URL here, it will vary depending on your
      # cluster and cloud provider.
      issuer: https://oidc.eks.us-west-2.amazonaws.com/id/my-cluster
```
</details>

Consult the [Helm chart reference
guide](../../reference/helm-reference/teleport-plugin-event-handler.mdx)
for more information on the `crd` and `tbot` sections.

### Example configuration file

Your helm configuration file `teleport-plugin-event-handler-values.yaml` should now
contain settings similar to the following. We will configure the `fluentd` section
to your log management solution of choice in the following guide.

(!docs/pages/includes/plugins/helm-operator-config.mdx!)
