{{ plugin="plugin" }}

### Generate credentials for the Event Handler plugin

Add the `crd` and `tbot` sections to the generated configuration file `{{ plugin }}-values.yaml`,
according to your Teleport cluster. The `teleport` section should be removed.

```yaml
# values.yaml
crd:
  create: true
  namespace: # The namespace where Teleport Kubernetes Operator is running
  tokenSpecOverride: {}

tbot:
  enabled: true
  clusterName: "teleport.example.com"
  teleportProxyAddress: "teleport.example.com:443"
```

**`crd`**

The `crd.create` field will tell the chart to create `TeleportRoleV8`, `TeleportBotV1`,
and `TeleportProvisionToken` custom resources. The Kubernetes Operator will watch
for these resources and update the corresponding resources in the Teleport cluster.
This will set up the Event Handler role and bot user for the Machine & Workload Identity bot, `tbot`,
to authenticate as when connecting to the Teleport cluster.

Ensure `crd.namespace` is set to the namespace the Kubernetes Operator is running in.

**`tbot`**

The `tbot` section configures the `tbot` deployment that will authenticate to Teleport on
behalf of the Teleport Event Handler plugin. By default, `tbot` will write an `identity` file
to a Kubernetes secret called `{{ plugin }}-tbot-out`.

<Admonition type="warning">
Ensure the `teleport` section is removed, since `tbot` is performing the authentication to the cluster.
</Admonition>

### Specifying a join method for tbot

The `TeleportProvisionToken` is used by `tbot` to authenticate as the newly created Event Handler bot user.
By default, the chart configures the `TeleportProvisionToken` custom resource to the `kubernetes`
in_cluster join method.

Optionally, you can override the token specification for other join methods
using the `crd.tokenSpecOverride` field. For `kubernetes` join types,
the chart automatically sets the allow rule to the `tbot` deployment's service account.
For other join methods, you must specify `tokenSpecOverride.join_method` and the corresponding
join method configuration.

See [the join method reference
](../../reference/deployment/join-methods.mdx) for a list of supported values and detailed explanations.

<details>
<summary>Example (Kubernetes JWKS join method)</summary>
You can override the TeleportProvisionToken specification to use the `kubernetes` JWKS join method.

```yaml
# values.yaml
tokenSpecOverride:
  join_method: kubernetes
  kubernetes:
    type: static_jwks
    static_jwks:
      jwks: |
        # Place the kubernetes JWKS here (`kubectl get --raw /openid/v1/jwks`)
        {"keys":[--snip--]}
```
</details>

<details>
<summary>Example (Kubernetes OIDC join method)</summary>
You can override the TeleportProvisionToken specification to use the `kubernetes` OIDC join method.

```yaml
# values.yaml
tokenSpecOverride:
  join_method: kubernetes
  kubernetes:
    type: oidc
    oidc:
      # Insert the OIDC issuer URL here, it will vary depending on your
      # cluster and cloud provider.
      issuer: https://oidc.eks.us-west-2.amazonaws.com/id/my-cluster
```
</details>
