---
title: Database Access with Redshift on AWS
description: How to configure Teleport Database Access with AWS Redshift PostgreSQL.
videoBanner: UFhT52d5bYg
---

# AWS Redshift PostgreSQL

## Prerequisites

- Teleport version `(=teleport.version=)`.
- AWS account with Redshift databases and permissions to create and attach IAM
  policies.

## Step 1/5. Install Teleport

(!docs/pages/includes/database-access/start-auth-proxy.mdx!)

## Step 2/5. Create Teleport user

(!docs/pages/includes/database-access/create-user.mdx!)

## Step 3/5. Configure IAM

### Create IAM policy for Teleport

Teleport needs AWS IAM permissions to be able to:

- Discover and register Redshift databases.
- Manage IAM user or IAM role policies.

Go to the [Policies](https://console.aws.amazon.com/iamv2/home#/policies) page
and create a managed IAM policy for the database agent.

<Tabs>
  <TabItem label="Redshift / IAM user">
  Use this policy if your Teleport database agent runs as IAM user (for example,
  uses AWS credentials file).
  ```json
  {
      "Version": "2012-10-17",
      "Statement": [
          {
              "Effect": "Allow",
              "Action": [
                  "redshift:DescribeClusters",
                  "iam:GetUserPolicy",
                  "iam:PutUserPolicy",
                  "iam:DeleteUserPolicy"
              ],
              "Resource": "*"
          }
      ]
  }
  ```
  </TabItem>
  <TabItem label="Redshift / IAM role">
  Use this policy if your Teleport database agent runs as IAM role (for example,
  on an EC2 instance with attached IAM role).
  ```json
  {
      "Version": "2012-10-17",
      "Statement": [
          {
              "Effect": "Allow",
              "Action": [
                  "redshift:DescribeClusters",
                  "iam:GetRolePolicy",
                  "iam:PutRolePolicy",
                  "iam:DeleteRolePolicy"
              ],
              "Resource": "*"
          }
      ]
  }
  ```
  </TabItem>
</Tabs>

### Create IAM permission boundary for Teleport
Since Teleport will be managing its own IAM policies for access to Redshift
databases, you need to create a permission boundary to limit its effective
range of permissions.

Create another managed policy that will serve as a permission boundary on the
same [Policies](https://console.aws.amazon.com/iamv2/home#/policies) page.

In addition to the set of permissions you created above, the boundary should
also include `redshift:GetClusterCredentials` which will grant your Teleport
agent the permssion to generate temporary credentials to authenticate with
Redshift databases.

<Tabs>
  <TabItem label="Redshift / IAM user">
  Use this permission boundary if your Teleport database agent runs as IAM user
  (for example, uses AWS credentials file).
  ```json
  {
      "Version": "2012-10-17",
      "Statement": [
          {
              "Effect": "Allow",
              "Action": [
                  "redshift:DescribeClusters",
                  "redshift:GetClusterCredentials",
                  "iam:GetUserPolicy",
                  "iam:PutUserPolicy",
                  "iam:DeleteUserPolicy"
              ],
              "Resource": "*"
          }
      ]
  }
  ```
  </TabItem>
  <TabItem label="Redshift / IAM role">
  Use this permission boundary if your Teleport database agent runs as IAM role
  (for example, on an EC2 instance with attached IAM role).
  ```json
  {
      "Version": "2012-10-17",
      "Statement": [
          {
              "Effect": "Allow",
              "Action": [
                  "redshift:DescribeClusters",
                  "redshift:GetClusterCredentials",
                  "iam:GetRolePolicy",
                  "iam:PutRolePolicy",
                  "iam:DeleteRolePolicy"
              ],
              "Resource": "*"
          }
      ]
  }
  ```
  </TabItem>
</Tabs>

### Attach policy and boundary to IAM identity

Attach created policy and permission boundary to the IAM identity your Teleport
database agent will be using. For example, if the agent runs as an IAM user:

<Figure>
![IAM user](../../../img/database-access/guides/rds/iam@2x.png)
</Figure>

<Admonition type="note" title="Self-managed IAM">
  If you prefer to self-manage IAM for your Redshift databases, take a look at
  [AWS reference](../reference/aws.mdx) for details.
</Admonition>

## Step 4/5. Start database agent
(!docs/pages/includes/database-access/token.mdx!)

Create the database agent configuration e.g. in `/etc/teleport.yaml`:

```yaml
teleport:
  data_dir: /var/lib/teleport
  auth_token: /tmp/token
  auth_servers:
  - teleport.example.com:443 # Teleport proxy address to connect to
auth_service:
  enabled: "no"
proxy_service:
  enabled: "no"
db_service:
  enabled: "yes"
  aws: # Matchers for registering AWS-hosted databases.
  - types: ["redshift"]
    regions: ["us-west-1"] # AWS regions to fetch databases from
    tags: # AWS database resource tags to match
      "*": "*"
```

Start the database agent:

```code
$ teleport start --config=/etc/teleport.yaml
```

The agent will discover all Redshift databases according to the configuration
and register them in the cluster. The agent will also attempt to configure IAM
access policies for the discovered databases. Keep in mind that AWS IAM changes
may not propagate immediately and can take a few minutes to come into effect.

<Admonition type="note" title="AWS credentials">
  Teleport database agent uses the default credential provider chain to find AWS
  credentials. See [Specifying Credentials](https://docs.aws.amazon.com/sdk-for-go/v1/developer-guide/configuring-sdk.html#specifying-credentials)
  for more information.
</Admonition>

## Step 5/5. Connect

Once the database agent has started and joined the cluster, login to see the
registered databases:

```code
$ tsh login --proxy=teleport.example.com --user=alice
$ tsh db ls
# Name        Description                    Labels
# ----------- ------------------------------ --------
# my-redshift Redshift cluster in us-east-1  ...
```

Log into particular database using `tsh db login` command:

```code
$ tsh db login my-redshift
```

<Admonition type="tip" title="Tip">
  You can be logged into multiple databases simultaneously.
</Admonition>

You can optionally specify the database name and the user to use by default
when connecting to the database instance:

```code
$ tsh db login --db-user=awsuser --db-name=dev my-redshift
```

<Admonition type="note" title="Users auto-create">
  Teleport does not currently use the auto-create option when generating
  tokens. Users must exist in the database.
</Admonition>

Now connect to the database:

```code
$ tsh db connect my-redshift
```

<Admonition type="note" title="Note">
  The `psql` command-line client should be available in PATH in order to be
  able to connect.
</Admonition>

To log out of the database and remove credentials:

```code
$ tsh db logout my-redshift
```

## Next steps

(!docs/pages/includes/database-access/guides-next-steps.mdx!)
