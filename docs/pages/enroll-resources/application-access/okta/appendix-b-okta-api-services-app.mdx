---
title: Appendix B. Okta API Services app
description: A guide for creating and configuring Okta API Services app providing Okta API access
  for Teleport using OAuth credentials.
---

<Admonition type="note">
This app is required only for integration *Level 3. User sync* and beyond. If you are planning to
only use *Level 1. SSO* and/or *Level 2. SCIM* integration, skip this section.
</Admonition>

Okta API services app provides credentials for Teleport to access Okta API. This app will have
[Okta custom admin
role](https://help.okta.com/en-us/content/topics/security/custom-admin-role/custom-admin-roles.htm)
and [Okta resource
set](https://help.okta.com/en-us/content/topics/security/custom-admin-role/create-resource-set.htm)
assigned to it allowing limiting Teleport access to the Okta organization resources.
Creating the custom admin role and the resource set is described in the later sections of this
guide.

## Create Okta API Services app

From the main navigation menu, select **Applications** -> **Applications**, and click
**Create App Integration**. Select API Services, then click **Next**.

![Create Okta API app](../../../../img/enterprise/plugins/okta/okta-api-app-1.png)

## Create admin role for the app

Okta API Services apps require assigning admin roles to be able to provide access to Okta
resources. Here's how to create a [custom admin
role](https://help.okta.com/en-us/content/topics/security/custom-admin-role/custom-admin-roles.htm)
with minimal permissions.

From the main navigation menu, select **Security** -> **Administrators**, then go to the **Roles**
tab and click **Create new role**.

![Create new Okta admin role](../../../../img/enterprise/plugins/okta/okta-create-new-admin-role.png)

Type in the role name and optionally the description and select following permissions for the role:

**User**

- View users and their details
- Edit users' group membership
- Edit users' application assignments

**Group**

- View groups and their details
- Manage group membership

**Application**

- View application and their details
- Edit application's user assignments 

And finally click **Save role**.

## Create resource set for the app

Now it's time to create an [Okta resource
set](https://help.okta.com/en-us/content/topics/security/custom-admin-role/create-resource-set.htm)
because it will be later needed to assign the custom admin role created in the previous section.

For that navigate to  **Security** -> **Administrators**, then go to the **Resources** tab and
click **Create new resource set**.

The press **+ Add Resource** to add 3 resource types: *Users*, *Groups* and *Applications*.

![Create new Okta resource set](../../../../img/enterprise/plugins/okta/okta-create-new-resource-set.png)

<Admonition type="tip">
Okta resource set can be utilized to limit the Okta resources Teleport can access.
</Admonition>

In the screenshot above all resources all allowed and that is a typical scenario, but it is ok to
allow Teleport access only to some of each 3 types of Okta resources remembering to include the
Okta SAML 2.0 application created earlier.

After setting up the resources and filling out the name and optional description click **Create**
and proceed.

<Admonition type="note">
Synchronization of Okta groups and applications can be also limited on the Teleport side in Okta
integration settings using pattern matching. It is described the Okta integration enrolment guide.
</Admonition>

<Admonition type="warning">
If limiting access to only some *Users*, *Groups* or *Applications*, an extra care has to be taken
to include the Okta SAML 2.0 app created earlier in this guide. Without access to this application
Teleport won't be able to synchronize users.
</Admonition>

## Configure the app

### 1. Disable proof of possession

As of right now Teleport doesn't support DPoP when using OAuth authorization Okta API Services app and it has to be disabled.

To disable DPoP stay in **General** tab, scroll down to the **General Settings** section and click
**Edit** in the top-right corner of the section. Then uncheck the "Require Demonstrating Proof of
Possession (DPoP) header in token requests" checkbox and click **Save**.

![Create Okta API app](../../../../img/enterprise/plugins/okta/okta-disable-dpop.png)

### 2. Setup Okta API Scopes

In the **Okta API Scopes** tab grant the following scopes: okta.apps.read, okta.apps.manage,
okta.groups.read, okta.groups.manage, okta.users.read, okta.users.manage.

![Okta API scopes setup](../../../../img/enterprise/plugins/okta/okta-api-app-scopes.png)

### 3. Assign Admin role

Navigate to the **Admin roles**, and click **Edit assignments**.

![Create Okta API app](../../../../img/enterprise/plugins/okta/okta-api-app-role-assignment.png)

Select the custom admin role and the resource set created earlier and click **Save changes**.
