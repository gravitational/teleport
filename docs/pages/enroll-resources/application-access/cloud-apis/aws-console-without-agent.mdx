---
title: Access AWS With Teleport
description: How to access AWS with Teleport.
labels:
 - how-to
 - zero-trust
---

You can protect the AWS Management Console and AWS APIs with Teleport.
This makes it possible to manage access to AWS infrastructure with Teleport features like Access Requests, Access Lists, and identity locking.
You can also configure Teleport to provide different levels of AWS access automatically when users authenticate using your single sign-on solution.

This guide will explain how to:

- Access the AWS Management Console through Teleport.
- Access the AWS Command Line Interface (CLI) through Teleport.
- Access applications using AWS SDKs through Teleport.

## How it works

In this setup, Teleport provides credentials for the user to assume one or more target IAM Roles.
Teleport users access the AWS Management Console and APIs through the Teleport Web UI and AWS CLI or other AWS tools.

Teleport checks the user's RBAC permissions when generating credentials, to ensure only authorized users get access and only to the authorized IAM Role.

Teleport uses AWS IAM Roles Anywhere to issue temporary credentials to users.
AWS IAM Roles Anywhere Profiles will appear as Teleport AWS Application resources in the Web UI and users can access their roles through the Web UI or CLI.

## Prerequisites

(!docs/pages/includes/edition-prereqs-tabs.mdx!)

- (!docs/pages/includes/tctl.mdx!)
- Permissions in AWS to:
  - create IAM Roles Anywhere Trust Anchor
  - create IAM Roles Anywhere Profiles
  - create IAM Roles
- `aws` command line interface (CLI) tool in PATH. Read the AWS documentation to
  [install or update the latest version of the AWS
  CLI](https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html).

## Step 1/4. Configure AWS IAM Roles Anywhere integration

In this section, you will configure AWS IAM resources to allow Teleport to issue AWS credentials.

<Admonition type="note">
Instead of doing this step manually, you can navigate to your Teleport Web UI, click on Enroll New Resource in Resources listing page, and follow the guide after clicking in AWS CLI/Console Access tile.
</Admonition>

You will create the following resources in AWS:

| Name                                 | Resource                        | Function                                                                                  |
|--------------------------------------|---------------------------------|-------------------------------------------------------------------------------------------|
| `TeleportRolesAnywhereIntegrationCA` | IAM Roles Anywhere Trust Anchor | Allow access from Teleport into AWS.                                                      |
| `TeleportRolesAnywhereProfileSync`   | IAM Role                        | Allows Teleport to iterate over AWS Roles Anywhere Profiles and import them as resources. |
| `TeleportRolesAnywhereProfileSync`   | IAM Roles Anywhere Profile      | Allows access to `TeleportRolesAnywhereProfileSync` IAM Role.                             |

### Create an IAM Roles Anywhere Trust Anchor which trusts Teleport

In this section, you will create an IAM Roles Anywhere Trust Anchor which trusts the Teleport's AWS Roles Anywhere CA.

1. Obtain the Teleport's certificate by:
<Tabs>
<TabItem label="Via curl">
```code
$ curl 'https://<Var name="teleport.example.com" />/webapi/auth/export?type=awsra'
-----BEGIN CERTIFICATE-----
MIIDqjCCApKgAwIBAgIQMIK8/WiQ/rUOrjlmB0IHVTANBgkqhkiG9w0BAQsFADBv
...
-----END CERTIFICATE-----
```
</TabItem>

<TabItem label="Via tctl">
```code
$ tctl auth export --type awsra
-----BEGIN CERTIFICATE-----
MIIDqjCCApKgAwIBAgIQMIK8/WiQ/rUOrjlmB0IHVTANBgkqhkiG9w0BAQsFADBv
...
-----END CERTIFICATE-----
```
</TabItem>
</Tabs>

1. Navigate to [Create a trust anchor](https://console.aws.amazon.com/rolesanywhere/home/trust-anchors/create) page.
Name the trust anchor `TeleportRolesAnywhereIntegrationCA` and add the Teleport's `awsra` CA certificate you obtained in the previous step as an External certificate bundle.
1. Copy the Trust Anchor ARN <Var name="Trust Anchor ARN" />

### Create an IAM Role and IAM Roles Anywhere Profile to sync AWS Roles Anywhere Profiles

1. Navigate to [Create Role](https://console.aws.amazon.com/iam/home?#/roles/create) and create a new IAM Role called `TeleportRolesAnywhereProfileSync`.
   Trust policy must include the Roles Anywhere service principal:
```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Principal": {
                "Service": "rolesanywhere.amazonaws.com"
            },
            "Action": [
                "sts:AssumeRole",
                "sts:SetSourceIdentity",
                "sts:TagSession"
            ]
        }
    ]
}
```

1. Copy the IAM Role ARN <Var name="Role ARN" />
1. Navigate to the [TeleportRolesAnywhereProfileSync Role](https://console.aws.amazon.com/iam/home?#/roles/details/TeleportRolesAnywhereProfileSync) and create a new inline policy:
```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "RolesAnywhereProfileSync",
            "Effect": "Allow",
            "Action": [
			    "rolesanywhere:ListProfiles",
			    "rolesanywhere:ListTagsForResource",
			    "rolesanywhere:ImportCrl",
			    "iam:GetRole"
            ],
            "Resource": [
                "*"
            ]
        }
    ]
}
```

1. Now, navigate to [Create a Profile](https://console.aws.amazon.com/rolesanywhere/home/profiles/create) page and name it `TeleportRolesAnywhereProfileSync`.
Add the role created in the last step (`TeleportRolesAnywhereProfileSync`) and create the Profile.
1. Copy the Profile ARN <Var name="Profile ARN" />

#### Create a Teleport AWS IAM Roles Anywhere integration
Now that the required AWS resources are created, you can create a Teleport AWS IAM Roles Anywhere integration.

1. Write the following contents to a file called `roles-anywhere-integration.yaml`:
```yaml
kind: integration
sub_kind: aws-ra
version: v1
metadata:
  name: <Var name="Integration Name" />
spec:
  aws_ra:
    trust_anchor_arn: <Var name="Trust Anchor ARN" />
    profile_sync_config:
      enabled: true
      profile_arn: <Var name="Profile ARN" />
      role_arn: <Var name="Role ARN" />
```

1. Create the integration with the following command:
```code
$ tctl create -f roles-anywhere-integration.yaml
```

Teleport will now start syncing AWS IAM Roles Anywhere Profiles as AWS application resources, every 5 minutes.

You can get the sync summary by running the following command:
```code
$ tctl get integration/<Var name="Integration Name" />
...
status:
  aws_ra:
    last_profile_sync:
      end_time: "2025-07-23T15:46:27.475629Z"
      error_message: ""
      start_time: "2025-07-23T15:46:26.334536Z"
      status: SUCCESS
      synced_profiles: 4
```

## Step 2/4. Create an AWS IAM Roles Anywhere Profile and assign IAM Roles

In this step, you will create an example Profile and Role so that you can test the integration.

If you are already leveraging AWS IAM Roles Anywhere Profiles, you can skip this step.

1. Navigate to [Create Role](https://console.aws.amazon.com/iam/home?#/roles/create) and create a new IAM Role called `ExampleReadOnlyAccess`.
Trust policy must include the Roles Anywhere service principal:
```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Principal": {
                "Service": "rolesanywhere.amazonaws.com"
            },
            "Action": [
                "sts:AssumeRole",
                "sts:SetSourceIdentity",
                "sts:TagSession"
            ]
        }
    ]
}
```

Add the AWS-managed `ReadOnlyAccess` policy to the role.
Copy the Role ARN <Var name="Read Only Role ARN" />.

1. Now, navigate to [Create a Profile](https://console.aws.amazon.com/rolesanywhere/home/profiles/create) page and name it `ExampleReadOnlyAccess`.
Add the role created in the last step (`ExampleReadOnlyAccess`) and create the Profile.

Copy the Profile ARN <Var name="Read Only Profile ARN" />.

1. You should now see the `ExampleReadOnlyAccess` profile listed in your Teleport Web UI in the Resources page.

## Step 3/4. Set up Access

### Create Teleport Role that gives access to a Profile/Roles combination

In this section, you'll create a Teleport Role which will grant access to the `ExampleReadOnlyAccess` Profile and associated IAM Role.

1. Create a file named `example-read-only-access-role.yaml` with the following contents:
```yaml
kind: role
version: v8
metadata:
  name: aws-ro-access
spec:
  allow:
  app_labels:
    'teleport.dev/aws-roles-anywhere-profile-arn': '<Var name="Read Only Profile ARN" />'
  aws_role_arns:
    - <Var name="Read Only Role ARN" />
```

1. Create the role with the following command:
```code
$ tctl create -f example-read-only-access-role.yaml
```

1. Assign the Role to the users you want to allow access. You can also assign it to an Access List or use it in conjunction with Access Requests.

## Step 4/4. Access AWS resources

Now that you have configured the Integration and set up the Role, users can access AWS resources through Teleport.

### Access AWS Management Console

1. Visit the home page of the Teleport Web UI and click **Resources**.
   If the Integration found any Profiles as expected, the Web UI will display the name of the Profile.

1. Click the **Launch** button for the AWS Console application, then click on the role you would like to assume when signing in to the AWS Console:

   ![IAM role selector](../../../../img/application-access/iam-role-selector.png)

1. You will get redirected to the AWS Management Console, signed in with the selected role.
   You should see your Teleport user name as a federated login assigned to `ExampleReadOnlyRole` in the top-right corner of the AWS Console:

   ![Federated login](../../../../img/application-access/federated-login@2x.png)

### Access AWS using AWS CLI or other AWS SDK based tools

#### Obtain the credentials
On your desktop, log into the AWS App Profile that was synced:

```code
$ tsh apps login --aws-role arn:aws:iam::278576220453:role/ExampleReadOnlyAccess example-read-only-access
Logged into AWS app "example-read-only-access".

Your IAM role:
    arn:aws:iam::123456789012:role/ExampleReadOnlyAccess

Example AWS CLI commands:
    aws --profile example-read-only-access s3 ls
    AWS_PROFILE=example-read-only-access aws s3 ls
```

#### Access AWS using AWS cli
You can now access all your AWS resources from the command line using the `aws` command line tool.

You need to pass the `--profile` flag or export the `AWS_PROFILE` environment variable with the name of the profile you created earlier.

```code
$ aws --profile example-read-only-access s3 ls
...
```

#### Access AWS from Terraform
Using Terraform requires you to set the profile in the provider.
```hcl
provider "aws" {
  profile = "example-read-only-access"
  // ...
}
```

Setting the `AWS_PROFILE` environment variable is also an option.

#### Set the default profile
Instead of always setting the AWS Profile in your commands/scripts/configurations, when logging in, you can set it to be the default AWS configuration profile.
```code
$ tsh apps login --aws-role arn:aws:iam::278576220453:role/ExampleReadOnlyAccess example-read-only-access --set-as-default-profile
```

Now, you will be able to run any AWS cli or AWS SDK based tool (including terraform) without any additional change.
