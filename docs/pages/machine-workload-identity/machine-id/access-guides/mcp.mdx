---
title: Machine & Workload Identity with MCP Access
description: How to use Machine & Workload Identity to access MCP servers
labels:
 - how-to
 - mwi
---

## Prerequisites

(!docs/pages/includes/edition-prereqs-tabs.mdx!)

- If you have not already connected your MCP server to Teleport, follow
the [MCP Getting Started guide](../../../enroll-resources/mcp-access/getting-started.mdx).
- (!docs/pages/includes/tctl.mdx!)
- `tbot` and `tsh` must already be installed and configured on the machine that
will access MCP servers. For more information, see the
[deployment guides](../deployment/deployment.mdx).

## Step 1/3. Configure RBAC

First, Teleport must be configured to allow the credentials produced by the bot
to access MCP servers in your infrastructure. In this example, access will be
granted to all MCP servers and all tools within those servers. This is done by
creating a role that grants the necessary permissions and then assigning this
role to the Bot.

```yaml
kind: role
version: v6
metadata:
  name: example-role
spec:
  allow:
    app_labels:
      '*': '*'
    mcp:
      tools: ['*']
```

Replace `example-role` with a descriptive name related to your use case.

In a production environment, you should adjust `app_labels` and `tools` to
restrict this access to only the MCP servers and tools that the bot will need
to access.

Use `tctl create -f ./role.yaml` to create the role.

(!docs/pages/includes/create-role-using-web.mdx!)

Now, use `tctl bots update` to add the role to the Bot. Replace `example`
with the name of the Bot you created in the deployment guide and `example-role`
with the name of the role you just created:

```code
$ tctl bots update example --add-roles example-role
```

## Step 2/3. Configure `tbot`

## Step 3/3. Connect your MCP client

You can now configure your MCP client to use the credentials produced by `tbot`
to access MCP servers. The exact steps you need to take will depend on the
MCP client you are using.

<Tabs>
    <TabItem label="LangGraph">
        For compatibility with LangGraph, use the `langchain-mcp-adapters`
        package. This package implements an MCP client and exposes the tools
        from an MCP server in the same way as tools defined natively in Python.

        ```python
            from langchain_mcp_adapters.client import MultiServerMCPClient
            client = MultiServerMCPClient({
                "my-mcp-server": {
                    "command": "tsh"
                    "args": [
                        "mcp",
                        "connect",
                        "-i", "/path",
                        "--proxy", "example.teleport.sh:443",
                        "my-mcp-server",
                    ],
                    "transport": "stdio",
                },
            })
            tools = await client.get_tools()
        ```

        See the [LangChain documentation](https://langchain-ai.github.io/langgraph/agents/mcp/)
        for further details.
    </TabItem>
    <TabItem label="Claude">
    </TabItem>
    <TabITem label="Other">
    </TabITem>
</Tabs>

## Next steps

- Read the [MCP access documentation](../../../enroll-resources/mcp-access/mcp-access.mdx)
to learn more about Teleport's MCP integration and RBAC controls.
- Read the [configuration reference](../../../reference/machine-id/configuration.mdx) to explore
all the available configuration options for `tbot`.
