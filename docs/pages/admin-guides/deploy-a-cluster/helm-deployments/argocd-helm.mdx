---
title: Guides for running Teleport using Helm via ArgoCD
description: How to install and configure Teleport in Kubernetes using Helm and ArgoCD
---

Teleport can provide secure, unified access to your Kubernetes clusters. This
guide will show you how to deploy Teleport Kubernetes agent on a Kubernetes cluster using Helm
and ArgoCD.

## How it works

AArgo CD is a declarative, GitOps continuous delivery tool for Kubernetes. This is used to orchestrate large deployments, and avoid the Kubernetes resources to drift from the desired deployment.

Teleport has [an official Helm chart (`teleport-kube-agent`)](../../../reference/helm-reference/teleport-kube-agent.mdx) that deploys a Teleport agent in a Kubernetes cluster. The agent can be configured to run several services, but by default it runs the `kubernetes_sevrice` to provide access to the Kubernetes API via Teleport.

This guide leverages ArgoCD's native Helm support to deploy the Teleport agent using the `teleport-kube-agent` Helm chart.

## Prerequisites

- A registered domain name. This is required for Teleport to set up TLS via
  Let's Encrypt and for Teleport clients to verify the Proxy Service host.

- An existing Kubernetes cluster you wish to provide access to via Teleport.

- At least one Teleport Agent running in your cluster publicly reachable with
  valid TLS certificates

 - (!docs/pages/includes/tctl.mdx!)

- An existing ArgoCD instance (version 2.10 or greater) that can deploy to the
  above Kubernetes cluster.

- The `tsh` client tool v(=teleport.version=)+ installed on your workstation.
  You can download this from our [installation page](../../../installation/installation.mdx).
  
## Generate a join token

Teleport agents use a join token to obtain certificates and connect to Teleport. See [joining docs](../../../reference/join-methods.mdx) for more information.
The token must be valid only on first join, the Teleport Kube agent will store its
certificates in Kubernetes and won't need a token to join again in the future.
In this section, we will create a token for the agent to join the Teleport cluster.
```code
$ tctl tokens add --type=kube,app --ttl=5m
```

You can specify the following token types:

(!docs/pages/includes/token-types.mdx!)

Ensure you update the values file you use for the helm chart
to include the required roles.

See the `teleport-kube-agent` [chart
reference](../../../reference/helm-reference/teleport-kube-agent.mdx#roles) for the
roles and token types that the chart supports.

Edit the values file to add the `kubeClusterName` field:

```yaml
kubeClusterName: mycluster
```

## Step 2/X. Write Helm values.yaml

Write the following values.yaml file and replace `joinParams.tokenName` and `proxyAddr`the value you collected previously ...

## Install the `teleport-kube-agent` Helm chart via ArgoCD

1. Create a namespace for Teleport and configure its Pod Security Admission,
   which enforces security standards on pods in the namespace:

   ```code
   $ kubectl create namespace teleport
   namespace/teleport created
   
   $ kubectl label namespace teleport 'pod-security.kubernetes.io/enforce=baseline'
   namespace/teleport labeled
   ```

2. Create a secret from your license file. Teleport will automatically discover
   this secret as long as your file is named `license.pem`.

(!docs/pages/includes//enterprise/obtainlicense.mdx!)

```code
$ kubectl -n teleport create secret generic license --from-file=license.pem
```

3. Create a new ArgoCD application using the following as a template.

``` yaml
project: default
source:
  repoURL: 'https://charts.releases.teleport.dev'
  targetRevision: (=teleport.version=)
  helm:
    values: |-

      roles: kube,app,discovery
      authToken: $YOUR_AUTH_TOKEN
      proxyAddr: $YOUR_PROXY_ADDR
      kubeClusterName: $KUBE_CLUSTER_NAME
      highAvailability:
          replicaCount: 2
          podDisruptionBudget:
              enabled: true
              minAvailable: 1
  chart: teleport-kube-agent
destination:
  server: 'https://kubernetes.default.svc'
  namespace: teleport
```

3. Edit this example configuration to match your needs.
   More information on how to modify helm this the helm chart
   and values can be found in the [Helm deployments guide](./helm-deployments.mdx).
4. Sync your changes to apply the configuration.
5. To verify setup, navigate to the 'Resources' page in your Teleport
   cluster to confirm the kubernetes cluster is registered.
