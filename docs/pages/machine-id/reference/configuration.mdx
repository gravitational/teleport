---
title: Machine ID Configuration Reference
description: Configuration reference for Teleport Machine ID.
---

This reference documents the various options that can be configured in `tbot`'s
configuration file. This configuration file offers more control than
configuring `tbot` using CLI parameters alone.

To configure `tbot` to use a configuration file, specify the path with the `-c`
flag, e.g `tbot -c ./tbot.yaml`.

Certain terms hold a specific meaning when used in reference to Machine ID,
these are:

- **Artifact**: an item that `tbot` will write to a destination as part of the
  process of generating an output. Examples of artifacts include configuration
  files, certificates and cryptographic key material. Usually these will be
  files, but this term is explicitly avoided as a destination may not be a
  filesystem.

# Configuration v2

From Teleport 14, `tbot` supports the v2 configuration version.

```yaml
# version specifies the version of the configuration file in use. `v2` is the
# most recent and should be used for all new bots. The rest of this example
# is in the `v2` schema.
version: v2

# debug enables verbose logging to stderr. If unspecified, this defaults to
# false.
debug: true

# auth_server specifies the Proxy or Auth Server that `tbot` should connect
# to. It is recommended to use the address of your Teleport Proxy, or, if using
# Teleport Cloud, the address of your Teleport Cloud instance.
auth_server: "teleport.example.com:443" # or "example.teleport.sh:443" for Teleport Cloud

# certificate_ttl specifies how long certificates generated by `tbot` should
# live for. It should be a positive, numeric value with an `m` (for minutes) or
# `h` (for hours) suffix. By default, this value is `1h`.
certificate_ttl: "1h"

# renewal_interval specifies how often `tbot` should aim to renew the
# outputs it has generated. It should be a positive, numeric value with an
# `m` (for minutes) or `h` (for hours) suffix. The default value is `20m`.
# This value must be lower than `certificate_ttl`.
# This value is ignored when using `tbot` is running in one-shot mode.
renewal_interval: "20m"

# oneshot configures `tbot` to exit immediately after generating the outputs.
# The default value is `false`. This is useful in ephemeral environments, like
# CI/CD.
oneshot: false

# onboarding is a group of configuration options that control how `tbot` will
# authenticate with the Teleport cluster.
onboarding:
  # token specifies which join token, configured in the Teleport cluster,
  # should be used to join the Teleport cluster.
  #
  # This can also be an absolute path to a file containing the value you wish
  # to be used.
  # File path example:
  # token: /var/lib/teleport/tokenjoin
  token: "00000000000000000000000000000000"

  # join_method must b the join method associated with the specified token
  # above. This should match the value output when creating the bot using
  # `tctl`.
  #
  # Support values include:
  # - `token`
  # - `azure`
  # - `circleci`
  # - `github`
  # - `gitlab`
  # - `iam`
  join_method: "token"

  # ca_pins are used to validate the identity of the Teleport Auth Server on
  # first connect. This should not be specified when using Teleport Cloud or
  # connecting via a Teleport Proxy.
  ca_pins:
    - "(=presets.ca_pin=)"
    - "(=presets.ca_pin=)"

  # ca_path is used to specify where a CA file can be found that can be used to
  # validate the identity of the Teleport Auth Server on first connect.
  # This should not be specified when using Teleport Cloud or connecting via a
  # Teleport Proxy. The ca_pins option should be preferred over ca_path.
  ca_path: "/path/to/ca.pem"

# storage specifies the destination that `tbot` should use to store its
# internal state. This state is sensitive, and you should ensure that the
# destination you specify here can only be accessed by `tbot`.
#
# If unspecified, storage will be set to a directory destination with a path
# of `/var/lib/teleport/bot`.
#
# See the full list of supported destinations and their configuration options
# under the Destinations section of this reference page.
storage:
  type: directory
  path: /var/lib/teleport/bot

# outputs specifies what artifacts `tbot` should generate and renew when it
# runs.
#
# See the full list of supported outputs and their configuration options
# under the Outputs section of this reference page.
outputs:
  - type: identity
    destination:
      type: directory
      path: /opt/machine-id
```

If no configuration file is provided, a simple configuration is used based
on the provided CLI flags. Given the following sample CLI from
`tctl bots add ...`:

```code
$ tbot start \
   --destination-dir=./tbot-user \
   --token=00000000000000000000000000000000 \
   --ca-pin=(=presets.ca_pin=) \
   --auth-server=auth.example.com:3025
```

it uses a configuration equivalent to the following:

```yaml
auth_server: auth.example.com:3025

onboarding:
  join_method: "token"
  token: "(=presets.tokens.first=)"
  ca_pins:
    - "(=presets.ca_pin=)"

storage:
  type: directory
  path: /var/lib/teleport/bot

outputs:
  - type: identity
    destination:
      type: directory
      path: ./tbot-user
```

## Outputs

Outputs define what actions `tbot` should take when it runs. They describe
what format of certificates should be generated, with what roles and to what
destination they should be written.

There are multiple types of output, select the one that is most appropriate for
your intended use-case.

### `identity`

The `identity` output can be used to authenticate:

- SSH access to your Teleport nodes, using `tsh`, openssh and tools like
  ansible.
- Administrative actions against your cluster using tools like `tsh` or `tctl`.
- Management of Teleport resources using the Teleport Terraform provider.
- Access to the Teleport API using the Teleport Go SDK.

See the [Getting Started guide](../getting-started.mdx) to see the `identity`
output used in context.

```yaml
# type specifies the type of the output. For the identity output, this will
# always be `identity`.
type: identity

(!docs/pages/includes/machine-id/common-output-config.mdx!)
```

### `application`

The `application` output is used to generate credentials that can be used to
access applications that have been configured with Teleport Application Access.

See the [Machine ID with Application Access guide](../guides/applications.mdx)
to see the `application` output used in context.

```yaml
# type specifies the type of the output. For the application output, this will
# always be `application`.
type: application
# app_name specifies the application name, as configured in your Teleport
# cluster, that `tbot` should generate credentials for.
# This field must be specified.
app_name: grafana

(!docs/pages/includes/machine-id/common-output-config.mdx!)
```

### `database`

The `database` output is used to generate credentials that can be used to
access databases that have been configured with Teleport Database Access.

See the [Machine ID with Database Access guide](../guides/databases.mdx)
to see the `database` output used in context.

```yaml
# type specifies the type of the output. For the database output, this will
# always be `database`.
type: database
# service is the name of the database service, as configured in Teleport,
# that the output should generate credentials for. This field must be specified.
service: my-postgres-server
# database is the name of the specific database on the specified database
# service to generate credentials for. This field may not need to be specified
# when using database types that do not have individual databases.
database: my-database
# username is the name of the user on the specified database service to
# generate credentials for. This field may not need to be specified
# when using database types that do not have users.
username: my-user
# format specifies what format the output artifacts should take. If
# unspecified, a sensible default is used. See the table titled "Supported
# formats" below for the full list of supported values.
format: tls

(!docs/pages/includes/machine-id/common-output-config.mdx!)
```

#### Supported formats

The following values may be provided to the `format` configuration field in
the `database` output type.

| `format`      | Description                          |
|---------------|--------------------------------------|
| Unspecified   | Provides a certificate in `tlscert`, a private key in `key` and the CA in `teleport-database-ca.crt`. This is compatible with most clients and databases. |
| `mongo`       | Provides `mongo.crt` and `mongo.cas`. This is designed to be used with MongoDB clients. |
| `cockroach`   | Provides `cockroach/node.key`, `cockroach/node.crt`, and `cockroach/ca.crt`. This is designed to be used with CockroachDB clients. |
| `tls`         | Provides `tls.key`, `tls.crt`, and `tls.cas`. This is for generic clients that require the specific file extensions. |

### `kubernetes`

The `kubernetes` output is used to generate credentials that can be used to
access Kubernetes clusters that have been configured with Teleport Kubernetes
Access.

It outputs a `kubeconfig.yaml` in the output destination, which can be used
with `kubectl`.

See the [Machine ID with Kubernetes Access guide](../guides/kubernetes.mdx)
to see the `kubernetes` output used in context.

```yaml
# type specifies the type of the output. For the kubernetes output, this will
# always be `kubernetes`.
type: kubernetes
# kubernetes_cluster is the name of the Kubernetes cluster, as configured in
# Teleport, that the output should generate credentials and a kubeconfig for.
# This field must be specified.
kubernetes_cluster: my-cluster

(!docs/pages/includes/machine-id/common-output-config.mdx!)
```

### `ssh_host`

The `ssh_host` output is used to generate the artifacts required to configure
an OpenSSH server with Teleport in order to allow Teleport users to connect to
it.

The artifacts it generates includes:
- `ssh_host-cert.pub`: a SSH certificate signed by Teleport's host CA.
- `ssh_host`: the private key associated with the SSH host certificate.
- `ssh_host-user-ca.pub`: an export of the Teleport user CA in an OpenSSH compatible format.

See the [Generating Short-Lived Host Certificates with Machine ID guide](../guides/host-certificate.mdx)
to see the `ssh_host` output used in context.


```yaml
type: ssh_host

(!docs/pages/includes/machine-id/common-output-config.mdx!)
```

## Destinations

A destination is somewhere that `tbot` can read and write artifacts.

Destinations are used in two places in the `tbot` configuration:

- Specifying where `tbot` should store its internal state.
- Specifying where an output should write the generated artifacts to.

Destinations come in multiple types, usually the `directory` type will be most
appropriate.

### `directory`

The `directory` destination type stores artifacts as files within a specified
directory. This is usually the correct destination type to use.

```yaml
# type specifies the type of the destination. For the directory destination,
# this will always be `directory`.
type: directory

# path specifies the path to the directory that this destination should write
# to. This directory should already exist, or `tbot init` should be used to
# create it with the correct permissions.
path: /opt/machine-id

# symlinks configures the behaviour of symlink attack prevention.
# Requires Linux 5.6+.
# Supported values:
#   * try-secure (default): Attempt to securely read and write certificates
#     without symlinks, but fall back (with a warning) to insecure read
#     and write if the host doesn't support this.
#   * secure: Attempt to securely read and write certificates, with a hard error
#     if unsupported.
#   * insecure: Quietly allow symlinks in paths.
symlinks: try-secure
# acls configures ACL setup when `tbot init` is run and revalidation of them
# when the destination is written to.
# Requires Linux with a file system that supports ACLs.
# Supported values:
#   * try (default on Linux): Attempt to use ACLs, warn at runtime if ACLs
#     are configured but invalid.
#   * off (default on non-Linux): Do not attempt to use ACLs.
#   * required: Always use ACLs, produce a hard error at runtime if ACLs
#     are invalid.
acls: try
```

### `memory`

The `memory` destination type stores artifacts within the process memory. This
means when the process exits, nothing will be persisted. This destination type
is most suitable for ephemeral environments, but can also be used for testing.

Configuration:

```yaml
# type specifies the type of the destination. For the memory destination, this
# will always be `memory`.
type: memory
```
