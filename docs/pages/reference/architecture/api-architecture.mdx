---
title: API Architecture
description: Architectural overview of the Teleport gRPC API.
---

This guide describes the architecture of the Teleport gRPC API, which enables
clients like `tctl`, the Teleport Terraform provider, and the Teleport
Kubernetes operator to manage dynamic resources in your Teleport cluster. If you
are new to the Teleport gRPC API, read how to [Get
Started](../../admin-guides/api/getting-started.mdx).

## Authentication

The Auth API uses mTLS to authenticate a client-server connection. Therefore, the client must provide
TLS certificates signed by the Auth Service to access the API. These are easy to create and provide using
[Credential loaders](#credentials).

## Authorization

The client certificates signed by the Auth Service will be associated with a specific user. This user will
be used to authorize API requests made by the client.

It is recommended to make a new user and role for each client. This makes it easier to track client actions,
as well as carefully control client permissions.

For example, if your client needs to use `client.GetRole()`, the user must have permission to perform the `read`
action on the `role` resource. You should create a user and role with the minimum permissions required.

(!docs/pages/includes/permission-warning.mdx!)

```code
# Copy and Paste the below and run on the Teleport Auth server.
cat > api-role.yaml <<EOF
kind: role
metadata:
  name: api-role
spec:
  allow:
    rules:
      - resources: ['role']
        verbs: ['read']
  deny:
    node_labels:
      '*': '*'
version: v5
EOF
# Create role
tctl create -f api-role.yaml
# Add user and login via web proxy
tctl users add api-user --roles=api-role
```

See our [roles](../access-controls/roles.mdx) documentation for more details
on role based access control.

## Credentials

The Teleport Go client requires credentials in order to authenticate with a
Teleport cluster.

Credentials are created by using Credential loaders, which gather certificates
and data generated by [Teleport CLIs](../cli/cli.mdx).

Since there are several Credential loaders to choose from with distinct
benefits, here's a quick breakdown:

 - Profile credentials are the easiest to get started with. All you have to do
   is log in to your device with `tsh login`. Your Teleport proxy address and
   credentials will automatically be located and used.
 - Identity File credentials are the most well-rounded in terms of usability,
   functionality, and customizability. Identity files can be generated through
   `tsh login`, `tctl auth sign`, or with
   [Machine ID](../../enroll-resources/machine-id/introduction.mdx).
 - Dynamic Identity File credentials are Identity File credentials with support for
   reloading credentials from disk. This makes them appropriate for Machine ID
   integrations, as you can reload the credentials when Machine ID rotates the
   underlying identity files.
 - Key pair credentials have a much simpler implementation than the other
   Credentials listed and may feel more familiar. These are good for
   authenticating clients hosted directly on the Auth Service.
 - TLS credentials leave everything up to the client user. This is mostly used
   internally, but some advanced users may find it useful.

Here are some more specific details to differentiate them by:

| Type | Profile Credentials | Identity Credentials | Key Pair Credentials | TLS Credentials |
| - | - | - | - | - |
| Ease of use | Easy | Easy | Medium | Hard |
| Supports long-lived certificates | Yes, but must be configured on server side | Yes | Yes | Yes |
| Supports SSH connections | Yes | Yes | No | No |
| Automatic Proxy Address discovery | Yes | No | No | No |
| CLI used | tsh | tctl/tsh | tctl | - |

See the [Credentials type](https://pkg.go.dev/github.com/gravitational/teleport/api/client#Credentials)
on pkg.go.dev for more information and examples for Credentials and Credential Loaders.

## Client connection

The API client makes requests through an open connection to the Teleport Auth
Service.

If the Auth Service is isolated behind a
[Proxy Server](../architecture/proxy.mdx), a reverse tunnel connection can be
made using SSH certificates signed by the Auth Service. You can either provide
the server's reverse tunnel address directly or provide the web proxy address
and have the client automatically retrieve the reverse tunnel address.

<Admonition type="note">
  While all Credential loaders support mTLS connections, only some support SSH connections (see the chart above).
</Admonition>

Take a look at this client constructor
[example](https://pkg.go.dev/github.com/gravitational/teleport/api/client#example-New)
to see what these connection options look like.
