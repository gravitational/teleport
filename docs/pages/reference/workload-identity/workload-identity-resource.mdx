---
title: WorkloadIdentity Resource
description: Information about the WorkloadIdentity resource
---

The WorkloadIdentity resource is used to define the structure of an identity
that can be issued to workloads, the rules around what workloads it can be
issued to, and the characteristics of the credentials that will be issued for
that identity.

It supports templating using attributes of the workload, such as the name of the
Kubernetes namespace or service account, which allows the WorkloadIdentity
resource to be used in a generic way for multiple distinct workloads.

```yaml
kind: workload_identity
version: v1
metadata:
  # The name of the WorkloadIdentity resource. This can be used to directly
  # request the issuance of a credential for this identity.
  name: my-workload
  # Key-value labels that can be used to group and filter WorkloadIdentity
  # resources when requesting issuance.
  labels:
    example: foo
spec:
  # Configuration relevant to issuing SPIFFE-compatible workload identity
  # credentials.
  spiffe:
    # The path element of the SPIFFE ID that will be included in credentials
    # issued for this identity.
    #
    # This must be prefixed with a forward-slash (`/`).
    #
    # Required. Supports templating.
    id: /foo/bar/{{ join.kubernetes.pod.name }}/{{ join.kubernetes.service_account.name }}
    # The hint field allows a string to be passed to workloads along with a
    # credential issued for this identity. This can be used to help workloads
    # differentiate between multiple identities that they may have
    # (e.g `internal` vs `external`).
    #
    # Optional. Supports templating.
    hint: An example hint
    # Grouped configuration for X.509 credentials.
    x509:
      # The DNS Subject Alternative Names (SANs) that should be included in any
      # X509-SVID issued using this WorkloadIdentity.
      #
      # Each individual element of this list supports templating and after
      # templating must be a valid DNS name.
      #
      # Optional, if not provided then no DNS SANs will be included in the X.509
      # credential.
      dns_sans:
      - example.com
      # Controls the subject distinguished name of an X509 workload identity
      # credential issued using this identity. If unspecified, a blank subject
      # will be used.
      #
      # In most circumstances, it is recommended to prefer relying on the
      # SPIFFE ID encoded in the URI SAN. However, the Subject DN may be needed
      # to support legacy systems designed for X.509 and not SPIFFE/WIMSE.
      subject_template:
        # The common name (CN - 2.5.4.3) of the subject distinguished name.
        # Supports templating. If not provided, the common name will be omitted.
        common_name: my-common-name
        # The organization (O - 2.5.4.10) of the subject distinguished name.
        # Supports templating. If not provided, the organization will be omitted.
        organization: my-organization
        # The organizational unit (OU - 2.5.4.11) of the subject distinguished
        # name. Supports templating. If not provided, the organizational unit
        # will be omitted.
        organizational_unit: my-organizational-unit
  # The rules control when this WorkloadIdentity can be used to issue a
  # credential.
  rules:
    # When allow rules are specified, at least one must pass in order for the
    # WorkloadIdentity to be used to issue a credential. This effectively
    # creates an OR relationship between the rules.
    #
    # If no allow rules are specified, then the WorkloadIdentity can be issued
    # to any workload with the correct workload_identity_labels within their
    # roleset.
    allow:
    # Each rule consists of a set of conditions. All conditions must pass in
    # order for the rule to be considered a match. This effectively creates an
    # AND relationship between the conditions.
    - conditions:
      # Each rule condition specifies the identity attribute to test, an
      # operator, and the values to test against.
      - attribute: join.kubernetes.pod.name
        # eq - Equals. This checks for an exact match between the attribute
        # and the specified value.
        eq:
          value: my-pod
      - attribute: join.kubernetes.namespace
        # not_eq - Not Equals. This checks for an exact mismatch between the
        # attribute and the specified value.
        not_eq:
          value: kube-system
      - attribute: join.kubernetes.service_account.name
        # in - In. This checks if the attribute is in the list of values.
        in:
          values: [my-service-account, my-other-service-account]
      - attribute: join.kubernetes.service_account.name
        # not_in - Not In. This checks if the attribute is not in the list of
        # values.
        not_in:
          values: [not-this-sa, not-this-sa-either]
```

## Templating

The following fields support templating:

- `spec.spiffe.id`
- `spec.spiffe.hint`
- `spec.spiffe.x509.dns_sans`
- `spec.spiffe.x509.subject_template.common_name`
- `spec.spiffe.x509.subject_template.organization`
- `spec.spiffe.x509.subject_template.organizational_unit`

## Rules

## Infrastructure as Code

In addition to the YAML representation which can be managed with `tctl`, the
WorkloadIdentity resource can also be managed using Infrastructure as Code
tools.

For further information see:

- [Terraform provider reference: teleport_workload_identity](../terraform-provider/resources/workload_identity.mdx)
