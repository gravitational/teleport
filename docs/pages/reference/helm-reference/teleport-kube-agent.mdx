---
title: teleport-kube-agent Chart Reference
description: Values that can be set using the teleport-kube-agent Helm chart
---

The `teleport-kube-agent` Helm chart is used to configure a Teleport agent that
runs in a remote Kubernetes cluster to provide access to resources in your
infrastructure. 

You can [browse the source on
GitHub](https://github.com/gravitational/teleport/tree/branch/v(=teleport.major_version=)/examples/chart/teleport-kube-agent).

This reference details available values for the `teleport-kube-agent` chart.

(!docs/pages/includes/backup-warning.mdx!)

## What the chart deploys

### Teleport services

The `teleport-kube-agent` chart can run any or all of three Teleport services:

| Teleport service                                             | Name for `roles` and `tctl tokens add` | Purpose                                                                                |
|--------------------------------------------------------------|----------------------------------------|----------------------------------------------------------------------------------------|
| [`kubernetes_service`](../../kubernetes-access/guides.mdx)   | `kube`                                 | Uses Teleport to handle authentication<br/> with and proxy access to a Kubernetes cluster   |
| [`application_service`](../../application-access/guides.mdx) | `app`                                  | Uses Teleport to handle authentication<br/> with and proxy access to web-based applications |
| [`database_service`](../../database-access/guides.mdx)       | `db`                                   | Uses Teleport to handle authentication<br/> with and proxy access to databases              |

### Legacy releases

Releases of this chart installed before version 11 are considered legacy
releases, which launch the Teleport pod as a `Deployment` if no storage was
configured. 

In version 11 and above, the chart launches the Teleport pod as a `StatefulSet`
even when the chart is configured not to use external storage, and the Teleport pod
reads its state from a Kubernetes `Secret`. 

While the Teleport pod does not require external storage, you can still use the
[`storage.enabled`](#storageenabled) field to configure the way the Teleport pod
reads data from a persistent volume.

To learn how upgrading from a legacy release to version 11 will affect
resources launched by this chart, see the [resource
list](#kubernetes-resources).

### Kubernetes resources

The `teleport-kube-agent` chart deploys the following Kubernetes resources:

| Kind                  | Default Name                                               | Description                                                                                                                                                                                                                                                                                             | When Deployed                                                                                                     |
|-----------------------|------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------|
| `StatefulSet`         | The release name                                           | Running a user-configured Teleport pod.                                                                                                                                                                                                                                                                 | Always.                                                                                                           |
| `Secret`              | `secretName` (default: `teleport-kube-agent-join-token`)   | Used for managing the state of the Teleport pod.                                                                                                                                                                                                                                                        | `authToken` or `joinParams.tokenName` is provided.                                                                |
| `Deployment`          | The release name                                           | Runs a user-configured Teleport pod.                                                                                                                                                                                                                                                                    | `storage.enabled` is `false` and the chart is being upgraded. Fresh installs will deploy a `StatefulSet` instead. |
| `Role`                | The `roleName` option, if given, or the release name.      | Used to manage the state of the Teleport pod via Kubernetes secrets.                                                                                                                                                                                                                                    | Always.                                                                                                           |
| `ClusterRole`         | `clusterRoleName`, if given, or the release name.          | Allows impersonating users, groups, and service accounts, getting pods, and creating [`SelfSubjectAccessReview`s](https://www.pulumi.com/registry/packages/kubernetes/api-docs/authorization/v1/selfsubjectaccessreview/) so the Teleport pod can manage access to resources in its Kubernetes cluster. | Always.                                                                                                           |
| `ClusterRoleBinding`  | `clusterRoleBindingName`, if provided, or the release name | Enables the Teleport pod to manage access to resources in the Kubernetes cluster.                                                                                                                                                                                                                       | Always.                                                                                                           |
| `RoleBinding`         | `roleBindingName`, if given, or the release name           | Enables the Teleport pod to manage access to resources in the Kubernetes cluster.                                                                                                                                                                                                                       | Always.                                                                                                           |
| `ServiceAccount`      | `serviceAccount.name`, if given, or the release name       | Enables the Teleport pod to manage access to resources in the Kubernetes cluster.                                                                                                                                                                                                                       | `serviceAccount.create` is `true`                                                                                 |
| `PodDisruptionBudget` | The release name                                           | Ensure high availability for the Teleport pod.                                                                                                                                                                                                                                                          | `highAvailability.podDisruptionBudget.enabled` is `true`.                                                         |
| `ServiceAccount`      | The release name, suffixed by `-hook`                      | Used to delete legacy `Deployment`s in order to deploy a `StatefulSet` instead. Removed once the upgrade is complete.                                                                                                                                                                                   | If the `teleport-kube-agent` release contains a legacy `Deployment` resource.                                     |
| `Role`                | The release name, suffixed by `-hook`                      | Used to delete legacy `Deployment`s in order to deploy a `StatefulSet` instead. Removed once the upgrade is complete.                                                                                                                                                                                   | If the `teleport-kube-agent` release contains a legacy `Deployment` resource.                                     |
| `RoleBinding`         | The release name, suffixed by `-hook`                      | Used to delete legacy `Deployment`s in order to deploy a `StatefulSet` instead. Removed once the upgrade is complete.                                                                                                                                                                                   | If the `teleport-kube-agent` release contains a legacy `Deployment` resource.                                     |
| `Job`                 | The release name, suffixed by `-hook`                      | Used to delete legacy `Deployment`s in order to deploy a `StatefulSet` instead. Removed once the upgrade is complete.                                                                                                                                                                                   | If the `teleport-kube-agent` release contains a legacy `Deployment` resource.                                     |
| `ConfigMap`           | The release name                                           | Contains the configuration for the Teleport pod.                                                                                                                                                                                                                                                        | Always.                                                                                                           |
| `PodSecurityPolicy`   | The release name                                           | Enforces security requirements for pods deployed by `teleport-kube-agent`.                                                                                                                                                                                                                              | `podSecurityPolicy.enabled` is `true` and the Kubernetes cluster supports pod security policies.                  |
| `Role`                | The release name, suffixed by `-psp`                       | Enforces security requirements for pods deployed by `teleport-kube-agent`.                                                                                                                                                                                                                              | `podSecurityPolicy.enabled` is `true` and the Kubernetes cluster supports pod security policies.                  |
| `RoleBinding`         | The release name, suffixed by `-psp`                       | Enforces security requirements for pods deployed by `teleport-kube-agent`.                                                                                                                                                                                                                              | `podSecurityPolicy.enabled` is `true` and the Kubernetes cluster supports pod security policies.                  |

## `roles`

This parameter is not mandatory to preserve backwards compatibility with older chart versions, but we recommend it is set.

| Type     | Default value |
|----------|---------------|
| `string` | `kube`        |

`roles` is a comma-separated list of services which should be enabled when running the `teleport-kube-agent` chart.

| Services                     | Value for `roles` | Mandatory additional settings for this role |
|------------------------------|-------------------|---------------------------------------------|
| Teleport Kubernetes service  | `kube`            | [`kubeClusterName`](#kubeclustername)       |
| Teleport Application service | `app`             | [`apps`](#apps)                             |
| Teleport Database service    | `db`              | [`databases`](#databases)                   |

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  roles: kube,app,db
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set roles=kube\,app\,db
  ```

  <Admonition type="note">
    When specifying multiple roles using `--set` syntax, you must escape the commas using a backslash (`\`).

    This is a quirk of Helm's CLI parser.
  </Admonition>

  </TabItem>
</Tabs>

If you specify a role here, you may also need to specify some other settings which are detailed in this reference.

## `enterprise`

| Type     | Default value |
|----------|---------------|
| `bool`   | `false`       |

When `enterprise` is set to `true`, the container image used for Teleport agent
pods run by the `teleport-kube-agent` chart will be the enterprise version.
This should be set to `true` for connecting to Teleport Cloud and self-hosted
Teleport Enterprise clusters to use enterprise features within the Kube Agent. 

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  enterprise: true
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set enterprise=true
  ```

  </TabItem>
</Tabs>

## `roleBindingName`

| Type     | Default value | Required? |
|----------|---------------|-----------|
| `string` | ""            | No        |

`roleBindingName` provides a custom name for the `RoleBinding` resource that the
`teleport-kube-agent` chart creates for the Teleport pod. By default, the
`RoleBinding` has the name of the Helm release. 

You should set this value if there is a `RoleBinding` resource in the namespace
of your `teleport-kube-agent` resources with the same name as your
`teleport-kube-agent` release.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  roleBindingName: myrolebinding
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set roleBindingName=myrolebinding
  ```

  </TabItem>
</Tabs>

## `roleName`

| Type     | Default value | Required? |
|----------|---------------|-----------|
| `string` | ""            | No        |

`roleName` provides a custom name for the `Role` resource that the
`teleport-kube-agent` chart creates for the Teleport pod. By default, the `Role`
has the name of the Helm release. 

You should set this value if there is a `Role` resource in the namespace of your
`teleport-kube-agent` resources with the same name as your `teleport-kube-agent`
release.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  roleName: myrole 
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set roleName=myrole
  ```

  </TabItem>
</Tabs>

## `serviceAccountName`

This field is deprecated and will be removed in a future version. Use
[`serviceAccount.name`](#serviceaccountname-1) instead.

## `authToken`

| Type     | Default value | Required? |
|----------|---------------|-----------|
| `string` | `nil`         | No        |

`authToken` provides a Teleport join token which will be used to join the Teleport instance to a Teleport cluster.

The value `joinParams` supports more methods to join the Teleport cluster and takes precedence if both `authToken`
and `joinParams` are set.

A token must be specified for the agent to join the Teleport cluster, either though `authToken`,
[`joinParams`](#joinparams), or [an existing Kubernetes Secret](#secretname).

| Services                          | Service Name  | `tctl tokens add` example            | `teleport.yaml` static token example        |
|-----------------------------------|---------------|--------------------------------------|---------------------------------------------|
| Kubernetes                        | `kube`        | `tctl tokens add --type=kube`        | `"kube:<replace-with-actual-token>"`        |
| Kubernetes, Application           | `kube,app`    | `tctl tokens add --type=kube,app`    | `"kube,app:<replace-with-actual-token>"`    |
| Kubernetes, Application, Database | `kube,app,db` | `tctl tokens add --type=kube,app,db` | `"kube,app,db:<replace-with-actual-token>"` |

<Admonition type="note">
  When you use a token, all of the services that it provides **must** be used.

  For example, you cannot use a token of type `app,db` to only join a Teleport `app` service by itself. It must join both `app` and `db` services at once.

  Also, each static token you configure must be unique, as the token itself is used to define which services will be supported.

  You cannot reuse the same static token and specify a different set of services.
</Admonition>

If you do not have the correct services (Teleport refers to these internally as `Roles`) assigned to your join token, the Teleport instance will
fail to join the Teleport cluster.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  authToken: <replace-with-actual-token>
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set authToken=<replace-with-actual-token>
  ```
  </TabItem>
</Tabs>

## `joinParams`

`joinParams` controls how the Teleport agent joins the Teleport cluster.
These sub-values must be configured for the agent to connect to a cluster.

### `joinParams.method`
| Type     | Default value | Required? |
|----------|---------------|-----------|
| `string` | `token`       | Yes       |

`joinParams.method` defines which join method will be used to join the Teleport cluster.
Possible values are `token`, `iam` and `ec2`.

- For `iam`, see [Joining Nodes Via AWS IAM Role](../../management/guides/joining-nodes-aws-iam.mdx).
- For `ec2`, see [Joining Nodes Via AWS IAM Role](../../management/guides/joining-nodes-aws-ec2.mdx).
- For `token` (default value), the token must be provided through `joinParams.tokenName` or
  [through an existing Kubernetes Secret](#secretName).

<Admonition type="note" title="IAM joining requirements">
Using the IAM joining method requires either the pods to have access to [instance
metadata](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/configuring-instance-metadata-service.html),
or [IAM roles for service
accounts](https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html) to be
set up on the pods's service account. For access to instance metadata (the quickest solution), see
[AWS's examples on how to restrict instance metadata access to a few
pods](https://aws.github.io/aws-eks-best-practices/security/docs/iam/#restrict-access-to-the-instance-profile-assigned-to-the-worker-node).
</Admonition>

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  joinParams:
    method: "token"|"ec2"|"iam"
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set joinParams.method="token"|"ec2"|"iam"
  ```
  </TabItem>
</Tabs>

### `joinParams.tokenName`
| Type     | Default value | Required? |
|----------|---------------|-----------|
| `string` | `nil`         | Yes       |

When `joinParams.method` is `iam` or `ec2`, `joinParams.tokenName` contains the name of the token that will be used to
join the cluster. In this case, the value is not sensitive as authorization is checked through AWS IAM or EC2.

When `joinParams.method` is `token` (by default), `joinParams.tokenName` contains the join token itself. In this case,
the value is sensitive and is automatically stored in a Kubernetes Secret instead of being directly included in the
agent's configuration.

If method is `token`, `joinParams.tokenName` can be empty if the token is provided through an existing Kubernetes
Secret, see [`secretName`](#secretName) for more details and instructions.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  joinParams:
    tokenName: "my-token"
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set joinParams.token="my-token"
  ```
  </TabItem>
</Tabs>

## `proxyAddr`

| Type     | Default value | Required? |
|----------|---------------|-----------|
| `string` | `nil`         | Yes       |

`proxyAddr` provides the public-facing Teleport proxy endpoint which should be used to join the cluster. This is the same URL that is used
to access the web UI of your Teleport cluster. It is the same as the value configured for `proxy_service.public_addr` in a traditional
Teleport cluster. The port used is usually either 3080 or 443.

Here are a few examples:

| Deployment method             | Example `proxy_service.public_addr` |
|-------------------------------|-------------------------------------|
| On-prem Teleport cluster      | `teleport.example.com:3080`         |
| Teleport Cloud cluster        | `example.teleport.sh:443`           |
| `teleport-cluster` Helm chart | `teleport.example.com:443`          |

## `kubeClusterName`

| Type     | Default value | Required?                      |
|----------|---------------|--------------------------------|
| `string` | `nil`         | When `kube` chart role is used |

`kubeClusterName` sets the name used for the Kubernetes cluster proxied by the Teleport agent. This name will be shown to Teleport users
connecting to the cluster.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  kubeClusterName: my-gke-cluster
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set kubeClusterName=my-gke-cluster
  ```
  </TabItem>
</Tabs>

## `apps`

| Type   | Default value | Required?                                                                            |
|--------|---------------|--------------------------------------------------------------------------------------|
| `list` | `[]`          | When `app` chart role is used at least one of `apps` and `appResources` is required. |

`apps` is a YAML list object detailing the applications that should be proxied by Teleport Application access.

You can specify multiple apps by adding additional list elements.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  apps:
  - name: grafana
    uri: http://localhost:3000
    labels:
      purpose: monitoring
  - name: jenkins
    uri: http://jenkins:8080
    labels:
      purpose: ci
  ```

  (!docs/pages/includes/yaml-lint-note.mdx!)
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set "apps[0].name=grafana" \
  --set "apps[0].uri=http://localhost:3000" \
  --set "apps[0].purpose=monitoring" \
  --set "apps[1].name=grafana" \
  --set "apps[1].uri=http://jenkins:8080" \
  --set "apps[1].purpose=ci"
  ```

  <Admonition type="note">
    Note that when using `--set` syntax, YAML list elements must be indexed starting at `0`.
  </Admonition>

  </TabItem>
</Tabs>

<Admonition type="tip" title="Supported values">
  You can see a list of all the supported [values which can be used in a Teleport application access configuration here](../../application-access/reference.mdx#configuration).
</Admonition>

## `appResources`

| Type   | Default value | Required?                                                                            |
|--------|---------------|--------------------------------------------------------------------------------------|
| `list` | `[]`          | When `app` chart role is used at least one of `apps` and `appResources` is required. |

`appResources` is a YAML list object detailing the resource selectors of the applications that should be proxied by the Teleport Application Service.

You can specify multiple selectors by including additional list elements.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  appResources:
  - labels:
      "env": "prod"
  - labels:
      "env": "test"
  ```

  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set "appResources[0].labels.env=prod" \
  --set "appResources[1].labels.env=test"
  ```

  <Admonition type="note">
    Note that when using `--set` syntax, YAML list elements must be indexed starting at `0`.
  </Admonition>

  </TabItem>
</Tabs>

<Admonition type="tip" title="Example">
  Once `appResources` is set, you can dynamically register application with `tsh` by following [this guide](../../application-access/guides/dynamic-registration.mdx).
</Admonition>

## `awsDatabases`

<Admonition type="tip" title="AWS database auto-discovery">
  This section configures AWS database auto-discovery. You can configure databases for other platforms using the [`azureDatabases`](#azuredatabases) or [`databases`](#databases) sections.
</Admonition>

<Admonition type="note" title="IAM roles">
  For AWS database auto-discovery to work, your Database Service pods will need to use a role which has appropriate IAM permissions as per the [database documentation](../../database-access/guides/rds.mdx#step-36-create-an-iam-policy-for-teleport).

  After configuring a role, you can use an `eks.amazonaws.com/role-arn` annotation with the `annotations.serviceAccount` value to associate it with the service account and grant permissions:

  ```
  annotations:
    serviceAccount:
      eks.amazonaws.com/role-arn: arn:aws:iam::1234567890:role/my-rds-autodiscovery-role
  ```
</Admonition>

| Type   | Default value | Required?                                                                                                                             |
|--------|---------------|---------------------------------------------------------------------------------------------------------------------------------------|
| `list` | `[]`          | When the `db` chart role is used at least one of `databases`, `awsDatabases`,<br/> `azureDatabases`, `databaseResources` is required. |

`awsDatabases` is a YAML list object detailing the filters for the AWS databases that should be discovered and proxied by Teleport Database access.

You can specify multiple database filters by adding additional list elements.

- `types` is a list containing the types of AWS databases that should be discovered.
- `regions` is a list of AWS regions which should be scanned for databases.
- `tags` can be used to set AWS tags that must be matched for databases to be discovered.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  roles: db
  awsDatabases:
    - types: ["rds"]
      regions: ["us-east-1", "us-west-2"]
      tags:
        "environment": "production"
    - types: ["rds"]
      regions: ["us-east-1"]
      tags:
        "environment": "dev"
    - types: ["rds"]
      regions: ["eu-west-1"]
      tags:
        "*": "*"
  annotations:
    serviceAccount:
      eks.amazonaws.com/role-arn: arn:aws:iam::1234567890:role/my-rds-autodiscovery-role
  ```

  (!docs/pages/includes/yaml-lint-note.mdx!)
  </TabItem>
</Tabs>

## `azureDatabases`

<Admonition type="tip" title="Azure database auto-discovery">
  This section configures Azure database auto-discovery. You can configure databases for other platforms using the [`awsDatabases`](#awsdatabases) or [`databases`](#databases) sections.
</Admonition>

<Admonition type="note" title="Azure IAM">
  For Azure database auto-discovery to work, your Database Service pods will need to have appropriate IAM permissions as per the [database documentation](../../database-access/guides/azure-postgres-mysql.mdx#step-46-configure-iam-permissions-for-teleport).

  After configuring a service principal with appropriate IAM permissions, you must pass credentials to the pods.
  The easiest way is to use an Azure client secret.

  First, create in the chart installation namespace a Kubernetes `Secret` containing the azure client secret:
  ```code
  $ kubectl create secret generic teleport-azure-client-secret --from-literal=client_secret=<your-azure-client-secret>
  secret/teleport-azure-client-secret created
  ```

  Then, use the [`extraEnv`](#extraenv) value to set the pods environment variables:

  ```yaml
  extraEnv:
  - name: AZURE_CLIENT_SECRET
    valueFrom:
      secretKeyRef:
      name: teleport-azure-client-secret
      key: client_secret
      optional: false
  - name: AZURE_TENANT_ID
    value: "11111111-2222-3333-4444-555555555555"
  - name: AZURE_CLIENT_ID
    value: "11111111-2222-3333-4444-555555555555"
  ```
</Admonition>

| Type   | Default value | Required?                                                                                                                             |
|--------|---------------|---------------------------------------------------------------------------------------------------------------------------------------|
| `list` | `[]`          | When the `db` chart role is used at least one of `databases`, `awsDatabases`,<br/> `azureDatabases`, `databaseResources` is required. |

`azureDatabases` is a YAML list object detailing the filters for the Azure databases that should be discovered and proxied by Teleport Database access.

You can specify multiple database filters by adding additional list elements.

Required fields for each filter:
- `types` is a list containing the types of Azure databases that should be discovered.
- `tags` can be used to set Azure resource tags that must be matched for databases to be discovered.

Optional fields for each filter:
- `regions` is a list of Azure regions which should be scanned for databases.
- `subscriptions` can be used to discover databases within matching Azure subscriptions.
- `resource_groups` can be used to discover databases within matching Azure resource groups.

The default for each of these optional settings is `*`, which will auto-discover in all
subscriptions, regions, or resource groups accessible by the Teleport service
principal in Azure.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  roles: db
  azureDatabases:
  - types: ["mysql", "postgres"]
    tags:
      "*": "*"
  - types: ["mysql"]
    tags:
      "env": ["dev", "staging"]
      "origin": "alice"
    regions: ["eastus", "centralus"]
    subscriptions: ["subID1", "subID2"]
    resource_groups: ["group1", "group2"]
  extraEnv:
  - name: AZURE_CLIENT_SECRET
    valueFrom:
      secretKeyRef:
      name: teleport-azure-client-secret
      key: client_secret
      optional: false
  - name: AZURE_TENANT_ID
    value: "11111111-2222-3333-4444-555555555555"
  - name: AZURE_CLIENT_ID
    value: "11111111-2222-3333-4444-555555555555"
  ```

  (!docs/pages/includes/yaml-lint-note.mdx!)
  </TabItem>
</Tabs>

## `databases`

| Type   | Default value | Required?                                                                                                                             |
|--------|---------------|---------------------------------------------------------------------------------------------------------------------------------------|
| `list` | `[]`          | When the `db` chart role is used at least one of `databases`, `awsDatabases`,<br/> `azureDatabases`, `databaseResources` is required. |

`databases` is a YAML list object detailing the databases that should be proxied by Teleport Database access.

You can specify multiple databases by adding additional list elements.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  databases:
  - name: aurora-postgres
    uri: postgres-aurora-instance-1.xxx.us-east-1.rds.amazonaws.com:5432
    protocol: postgres
    aws:
      region: us-east-1
    static_labels:
      env: staging
  - name: mysql
    uri: mysql-instance-1.xxx.us-east-1.rds.amazonaws.com:3306
    protocol: mysql
    aws:
      region: us-east-1
    static_labels:
      env: staging
  ```

  (!docs/pages/includes/yaml-lint-note.mdx!)
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set "databases[0].name=aurora" \
  --set "databases[0].uri=postgres-aurora-instance-1.xxx.us-east-1.rds.amazonaws.com:5432" \
  --set "databases[0].protocol=postgres" \
  --set "databases[0].aws.region=us-east-1" \
  --set "databases[0].static_labels.env=staging" \
  --set "databases[1].name=mysql" \
  --set "databases[1].uri=mysql-instance-1.xxx.us-east-1.rds.amazonaws.com:3306" \
  --set "databases[1].protocol=mysql" \
  --set "databases[1].aws.region=us-east-1" \
  --set "databases[1].static_labels.env=staging"
  ```

  <Admonition type="note">
    Note that when using `--set` syntax, YAML list elements must be indexed starting at `0`.
  </Admonition>

  </TabItem>
</Tabs>

<Admonition type="tip" title="Supported values">
  You can see a list of all the supported [values which can be used in a Teleport database service configuration here](../../database-access/reference/configuration.mdx).
</Admonition>

<Admonition type="tip" title="Trusting Database CA">
  Database CAs can be trusted on a per-database basis.
  You must create a secret containing the database CA certificate in the same namespace as Teleport using a command like:

  ```code
  $ kubectl create secret generic my-postgres-ca --from-file=ca.pem=/path/to/database-ca.pem
  ```

  Then, deploy the Helm chart with the following values:

  ```yaml
  databases:
  - name: my-postgres
    uri: postgres.example.com:5432
    protocol: postgres
    tls:
      ca_cert_file: "/etc/teleport-tls-db/my-postgres/ca.pem"
  extraVolumes:
    - name: my-postgres-ca
      secret:
        secretName: my-postgres-ca
  extraVolumeMounts:
    - name: my-postgres-ca
      mountPath: /etc/teleport-tls-db/my-postgres
      readOnly: true
  ```
</Admonition>

## `databaseResources`

| Type   | Default value | Required?                                                                                                                             |
|--------|---------------|---------------------------------------------------------------------------------------------------------------------------------------|
| `list` | `[]`          | When the `db` chart role is used at least one of `databases`, `awsDatabases`,<br/> `azureDatabases`, `databaseResources` is required. |

`databaseResources` is a YAML list object detailing the resource selectors of the databases that should be proxied by the Teleport Database Service.

You can specify multiple selectors by adding elements to the list.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  databaseResources:
  - labels:
      "env": "prod"
      "engine": "postgres"
  - labels:
      "env": "test"
      "engine": "mysql"
  ```

  </TabItem>
  <TabItem label="--set">
  ```code
  $
  --set "databaseResources[0].labels.env=prod" \
  --set "databaseResources[0].labels.engine=postgres" \
  --set "databaseResources[1].labels.env=test" \
  --set "databaseResources[0].labels.engine=mysql"
  ```

  <Admonition type="note">
    Note that when using `--set` syntax, YAML list elements must be indexed starting at `0`.
  </Admonition>

  </TabItem>
</Tabs>

<Admonition type="tip" title="Example">
  Once `databaseResources` is set, you can dynamically register database with `tsh` by following [this guide](../../database-access/guides/dynamic-registration.mdx).
</Admonition>

## `teleportVersionOverride`

| Type     | Default value |
|----------|---------------|
| `string` | `nil`         |

Normally the version of Teleport being used will match the version of the chart being installed. If you install chart version
7.0.0, you'll be using Teleport 7.0.0.

You can optionally override this to use a different published Teleport Docker image tag like `6.0.2` or `7`.

See [this link for information on Community Docker image versions](../../management/guides/docker.mdx#step-14-pick-your-image).

<Admonition type="note">
  The `teleport-kube-agent` chart always runs using Teleport Community edition as it does not require any Enterprise features, so it does
  not require a Teleport license file to be provided.
</Admonition>

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  teleportVersionOverride: "7"
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set teleportVersionOverride="7"
  ```
  </TabItem>
</Tabs>

## `caPin`

| Type   | Default value |
|--------|---------------|
| `list` | `[]`          |

When `caPin` is set, the Teleport pod will use its values to check the
Auth Service's identity when first joining a cluster. This enables a more secure
way of adding new Teleport instances to a cluster. See
["Adding Nodes to the Cluster"](../../management/admin/adding-nodes.mdx).

Each list element can be the pin itself (recommended, works out of the box),
or a path to a file containing the pin. For the latter it is your
responsibility to mount the file using [`extraVolumes`](#extraVolumes).

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  caPin: ["sha256:7e12c17c20d9cb504bbcb3f0236be3f446861f1396dcbb44425fe28ec1c108f1"]
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set caPin[0]="sha256:7e12c17c20d9cb504bbcb3f0236be3f446861f1396dcbb44425fe28ec1c108f1"
  ```
  </TabItem>
</Tabs>

## `insecureSkipProxyTLSVerify`

| Type   | Default value |
|--------|---------------|
| `bool` | `false`       |

When `insecureSkipProxyTLSVerify` is set to `true`, the Teleport instance will skip the verification of the TLS certificate presented by the Teleport
Proxy Service specified using [`proxyAddr`](#proxyaddr).

This can be used for joining a Teleport instance to a Teleport cluster which does not have valid TLS certificates for testing.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  insecureSkipProxyTLSVerify: false
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set insecureSkipProxyTLSVerify=false
  ```
  </TabItem>
</Tabs>

<Admonition type="warning">
  Using a self-signed TLS certificate and disabling TLS verification is OK for testing, but is not viable when running a production Teleport
  cluster as it will drastically reduce security. You must configure valid TLS certificates on your Teleport cluster for production workloads.

  One option might be to use Teleport's built-in [ACME support](./teleport-cluster.mdx#acme) or enable [cert-manager support](./teleport-cluster.mdx#highavailabilitycertmanager).
</Admonition>

## `teleportConfig`

`teleportConfig` contains YAML teleport configuration to pass to the Teleport pods.
The configuration will be merged with the chart-generated configuration
and will take precedence in case of conflict.

See the [Teleport Configuration Reference](../config.mdx) for the list of supported fields.

```yaml
teleportConfig:
  app_service:
    debug_app: true
  discovery_service:
    enabled: true
    azure:
    - types: ["aks"]
      tags:
        "*":"*"
```

## `tls`

### `existingCASecretName`

| Type     | Default value |
|----------|---------------|
| `string` | `""`          |

`tls.existingCASecretName` sets the `SSL_CERT_FILE` environment variable to load a trusted CA or bundle in PEM format into Teleport pods.
This can be set to inject a root and/or intermediate CA so that Teleport can build a full trust chain on startup.
The injected CA will be used to validate TLS communications, with the Proxy Service, with upstream applications or databases.

<Admonition type="note">
The recommended way to trust a database CA is to do it per-database instead of adding the CA to the global Teleport trust store.
It allows to trust multiple CAs while limiting the trust scope to their specific databases. See [the `databases` section](#databases).
</Admonition>

You must create a secret containing the CA certs in the same namespace as Teleport using a command like:

```code
$ kubectl create secret generic my-root-ca --from-file=ca.pem=/path/to/root-ca.pem
```

<Notice type="warning" title="Root CA filename">
  The key containing the root CA in the secret must be `ca.pem`.
</Notice>

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  tls:
    existingCASecretName: my-root-ca
  ```
  </TabItem>
  <TabItem label="--set">
  ```shell
  --set tls.existingSecretName=my-root-ca
  ```
  </TabItem>
</Tabs>

## `existingDataVolume`

| Type     | Default value |
|----------|---------------|
| `string` | `""`          |

When `existingDataVolume` is set to the name of an existing volume, the `/var/lib/teleport` mount will use this volume instead of creating a new `emptyDir` volume.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  existingDataVolume: my-volume
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  --set existingDataVolume=my-volume
  ```
  </TabItem>
</Tabs>

## `podSecurityPolicy`

### `podSecurityPolicy.enabled`

| Type   | Default value |
|--------|---------------|
| `bool` | `true`        |

By default, Teleport charts also install a [`podSecurityPolicy`](https://github.com/gravitational/teleport/blob/master/examples/chart/teleport-kube-agent/templates/psp.yaml).

To disable this, you can set `enabled` to `false`.

[Kubernetes reference](https://kubernetes.io/docs/concepts/policy/pod-security-policy/)

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  podSecurityPolicy:
    enabled: false
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set podSecurityPolicy.enabled=false
  ```
  </TabItem>
</Tabs>

## `labels`

| Type     | Default value |
|----------|---------------|
| `object` | `{}`          |

`labels` can be used to add a map of key-value pairs for the `kubernetes_service` which is deployed using the `teleport-kube-agent` chart.
These labels can then be used with Teleport's RBAC policies to define access rules for the cluster.

<Admonition type="note">
  These are Teleport-specific RBAC labels, not Kubernetes labels.
</Admonition>

<Admonition type="note">
  For historical/backwards compatibility reasons, these labels will only be applied to the Kubernetes cluster being joined via the
  Teleport Kubernetes service.

  To set labels for applications, add a `labels` element to the [`apps`](#apps) section.
  To set labels for databases, add a `static_labels` element to the [`databases`](#databases) section.

  For more information on how to set static/dynamic labels for Teleport services, see [labelling nodes and applications](../../management/admin/labels.mdx).
</Admonition>

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  labels:
    environment: production
    region: us-east
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set labels.environment=production \
  --set labels.region=us-east
  ```
  </TabItem>
</Tabs>

## `storage`

### `storage.enabled`

| Type   | Default value |
|--------|---------------|
| `bool` | `false`       |

Enables the creation of a Kubernetes persistent volume to hold Teleport instance state.

[Kubernetes reference](https://kubernetes.io/docs/concepts/storage/persistent-volumes/)

#### Chart upgrades for legacy releases

If you are upgrading a legacy `teleport-kube-agent` release (pre-v11), the way
the `teleport-kube-agent` chart handles upgrades differs depending on the value
of `storage.enabled`. Prior to v11, the chart ran the Teleport pod as a
`Deployment` if `storage.enabled` was `false` and a `StatefulSet` if it was
`true`. In v11 and after, the chart always runs the Teleport pod as a
`StatefulSet`.

During an upgrade, if `storage.enabled` is `false`, the chart installs a
`StatefulSet` resource to run the Teleport pod alongside the existing
`Deployment`. Once the `StatefulSet` joins the cluster and becomes healthy, the
chart deletes the `Deployment` using a [Helm
hook](https://helm.sh/docs/topics/charts_hooks/), and the upgrade finishes.

If `storage.enabled` is `true`, then during the upgrade, the
`teleport-kube-agent` chart will use the existing `StatefulSet` resource to run
the Teleport pod. The chart will import the pod's identify from the previously
configured external storage into a Kubernetes `Secret`. 

#### New chart installations

New installations of `teleport-kube-agent` always launch the Teleport pod as a
`StatefulSet`, and the pod reads its state from a Kubernetes `Secret`. Setting
`storage.enabled` to `true` is not required for the Teleport pod to maintain its
state.

If `storage.enabled` is `true`, the chart creates a volume mount for the
Teleport pod that persists across the lifetimes of all Teleport pods deployed on
a particular node. The Teleport pod uses this volume mount to manage its data,
which is useful for storing session recordings locally.

You can configure this persistent storage using `storage.storageClassName` and
`storage.requests`.

If `storage.enabled` is `false`, the chart configures the Teleport pod to manage
its data with a temporary directory that exists until the Teleport pod stops
running.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  storage:
    enabled: true
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  --set storage.enabled=true
  ```
  </TabItem>
</Tabs>

### `storage.storageClassName`

| Type     | Default value |
|----------|---------------|
| `string` | `nil`         |

The storage class name the persistent volume should use when creating persistent volume claims. The provided storage class
name needs to exist on the Kubernetes cluster for Teleport to use.

[Kubernetes reference](https://kubernetes.io/docs/concepts/storage/storage-classes/)

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  storage:
    storageClassName: teleport-storage-class
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  --set storage.storageClassName=teleport-storage-class
  ```
  </TabItem>
</Tabs>

### `storage.requests`

| Type     | Default value |
|----------|---------------|
| `string` | `128Mi`       |

The size of persistent volume to create.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  storage:
    requests: 128Mi
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  --set storage.requests=128Mi
  ```
  </TabItem>
</Tabs>

## `image`

| Type     | Default value                           |
|----------|-----------------------------------------|
| `string` | `public.ecr.aws/gravitational/teleport` |

`image` sets the container image used for Teleport pods run by the `teleport-kube-agent` chart.

You can override this to use your own Teleport image rather than a Teleport-published image.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  image: my.docker.registry/teleport-image-name
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set image=my.docker.registry/teleport-image-name
  ```
  </TabItem>
</Tabs>

## `imagePullSecrets`

| Type   | Default value | Can be used in `custom` mode? |
|--------|---------------|-------------------------------|
| `list` | `[]`          | âœ…                             |

[Kubernetes reference](https://kubernetes.io/docs/concepts/containers/images/#specifying-imagepullsecrets-on-a-pod)

A list of secrets containing authorization tokens which can be optionally used to access a private Docker registry.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  imagePullSecrets:
  - name: my-docker-registry-key
  ```
  </TabItem>
  <TabItem label="--set">
  ```shell
  --set "imagePullSecrets[0].name=my-docker-registry-key"
  ```
  </TabItem>
</Tabs>

### `highAvailability`

## `highAvailability.replicaCount`

| Type  | Default value |
|-------|---------------|
| `int` | `1`           |

`highAvailability.replicaCount` can be used to set the number of replicas used in the deployment.

Set to a number higher than `1` for a high availability mode where multiple Teleport pods will be deployed.

<Admonition type="tip" title="Sizing guidelines">
  As a rough guide, we recommend configuring one replica per distinct availability zone where your cluster has worker nodes.

  2 replicas/availability zones will be fine for smaller workloads. 3-5 replicas/availability zones will be more appropriate for bigger
  clusters with more traffic.
</Admonition>

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  highAvailability:
    replicaCount: 3
  ```
  </TabItem>
  <TabItem label="--set">
  ```shell
  --set highAvailability.replicaCount=3
  ```
  </TabItem>
</Tabs>

## `highAvailability.requireAntiAffinity`

| Type   | Default value |
|--------|---------------|
| `bool` | `false`       |

[Kubernetes reference](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#node-affinity)

Setting `highAvailability.requireAntiAffinity` to `true` will use `requiredDuringSchedulingIgnoredDuringExecution` to require that multiple
Teleport pods must not be scheduled on the same physical host.

<Admonition type="warning">
  This can result in Teleport pods failing to be scheduled in very small clusters or during node downtime, so should be used with caution.
</Admonition>

 Setting `highAvailability.requireAntiAffinity` to `false` (the default) uses `preferredDuringSchedulingIgnoredDuringExecution` to make node
 anti-affinity a soft requirement.

<Admonition type="note">
  This setting only has any effect when `highAvailability.replicaCount` is greater than `1`.
</Admonition>

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  highAvailability:
    requireAntiAffinity: true
  ```
  </TabItem>
  <TabItem label="--set">
  ```shell
  --set highAvailability.requireAntiAffinity=true
  ```
  </TabItem>
</Tabs>

## `highAvailability.podDisruptionBudget`

### `highAvailability.podDisruptionBudget.enabled`

| Type   | Default value |
|--------|---------------|
| `bool` | `false`       |

[Kubernetes reference](https://kubernetes.io/docs/tasks/run-application/configure-pdb/)

Enable a Pod Disruption Budget for the Teleport Pod to ensure HA during voluntary disruptions.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  highAvailability:
    podDisruptionBudget:
      enabled: true
  ```
  </TabItem>
  <TabItem label="--set">
  ```shell
  --set highAvailability.podDisruptionBudget.enabled=true
  ```
  </TabItem>
</Tabs>

### `highAvailability.podDisruptionBudget.minAvailable`

| Type  | Default value |
|-------|---------------|
| `int` | `1`           |

[Kubernetes reference](https://kubernetes.io/docs/tasks/run-application/configure-pdb/)

Ensures that this number of replicas is available during voluntary disruptions, can be a number of replicas or a percentage.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  highAvailability:
    podDisruptionBudget:
      minAvailable: 1
  ```
  </TabItem>
  <TabItem label="--set">
  ```shell
  --set highAvailability.podDisruptionBudget.minAvailable=1
  ```
  </TabItem>
</Tabs>

## `clusterRoleName`

| Type     | Default value |
|----------|---------------|
| `string` | `nil`         |

`clusterRoleName` can be optionally used to override the name of the Kubernetes `ClusterRole` used by the `teleport-kube-agent` chart's `ServiceAccount`.

<Admonition type="note">
  Most users will not need to change this.
</Admonition>

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  clusterRoleName: kubernetes-clusterrole
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set clusterRoleName=kubernetes-clusterrole
  ```
  </TabItem>
</Tabs>

## `clusterRoleBindingName`

<Admonition type="note">
  Most users will not need to change this.
</Admonition>

| Type     | Default value |
|----------|---------------|
| `string` | `nil`         |


`clusterRoleBindingName` can be optionally used to override the name of the Kubernetes `ClusterRoleBinding` used by the `teleport-kube-agent` chart's `ServiceAccount`.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  clusterRoleBindingName: kubernetes-clusterrolebinding
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set clusterRoleBindingName=kubernetes-clusterrolebinding
  ```
  </TabItem>
</Tabs>

## `priorityClassName`

| Type     | Default value |
|----------|---------------|
| `string` | `nil`         |

`priorityClassName` allows to specify a priority class for the `teleport-kube-agent` deployment/statefulset.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  priorityClassName: "teleport-kube-agent"
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set priorityClassName=teleport-kube-agent
  ```
  </TabItem>
</Tabs>

## `serviceAccount.create`

| Type      | Default value | Required? | Can be used in `custom` mode? |
|-----------|---------------|-----------|-------------------------------|
| `boolean` | `true`        | No        | âœ…                             |

[Kubernetes reference](https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/)

Boolean value to control whether Helm Chart should create the `ServiceAccount`.
When off, the `serviceAccount.name` parameter should be set to the existing `ServiceAccount` name.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  serviceAccount:
    create: false
    name: kubernetes-serviceaccount
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set serviceAccount.create=false
  $ --set serviceAccount.name=kubernetes-serviceaccount
  ```
  </TabItem>
</Tabs>

## `serviceAccount.name`

| Type     | Default value | Required? | Can be used in `custom` mode? |
|----------|---------------|-----------|-------------------------------|
| `string` | `""`          | No        | âœ…                             |

`serviceAccount.name` provides a custom name for the `ServiceAccount` resource
that the `teleport-kube-agent` chart creates for the Teleport pod. By default,
the `ServiceAccount` has the name of the Helm release. 

You should set this value if there is a `ServiceAccount` resource in the
namespace of your `teleport-kube-agent` resources with the same name as your
`teleport-kube-agent` release.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  serviceAccount:
    name: kubernetes-serviceaccount
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set serviceAccount.name=kubernetes-serviceaccount
  ```
  </TabItem>
</Tabs>

## `secretName`

| Type     | Default value                    |
|----------|----------------------------------|
| `string` | `teleport-kube-agent-join-token` |

`secretName` is the name of the Kubernetes Secret containing the Teleport join token used by the chart.

If `joinParams.method` is `token` and you set both `authToken` and `joinParams.tokenName` to a blank value, the chart
will not attempt to create the secret itself. Instead, it will read the value from an existing secret. `secretName`
configures the name of this secret. This allows you to configure this secret externally and avoid having a plaintext
join token stored in your Teleport chart values.

To create your own join token secret, you can use a command like this:

```code
$ kubectl --namespace teleport create secret generic teleport-kube-agent-join-token --from-literal=auth-token=<replace-with-actual-token>
```

<Admonition type="note">
  The key used for the auth token inside the secret must be `auth-token`, as in the command above.
</Admonition>

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  secretName: "secret-i-created-before"
  joinParams:
    method: "token"
    tokenName: ""
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set secretName="secret-i-created-before" \
    --set joinParams.method="token" \
    --set joinParams.tokenName=""
  ```
  </TabItem>
</Tabs>

## `log`

### `log.level`

<Admonition type="note">
  This field used to be called `logLevel`. For backwards compatibility this name can still be used, but we recommend changing your values file to use `log.level`.
</Admonition>

| Type     | Default value |
|----------|---------------|
| `string` | `INFO`        |

`log.level` sets the log level used for the Teleport process.

Available log levels (in order of most to least verbose) are: `DEBUG`, `INFO`, `WARNING`, `ERROR`.

The default is `INFO`, which is recommended in production.

`DEBUG` is useful during first-time setup or to see more detailed logs for debugging.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  log:
    level: DEBUG
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  --set log.level=DEBUG
  ```
  </TabItem>
</Tabs>

### `log.output`

| Type     | Default value | Can be used in `custom` mode? | `teleport.yaml` equivalent |
|----------|---------------|-------------------------------|----------------------------|
| `string` | `stderr`      | âŒ                             | `teleport.log.output`      |

`log.output` sets the output destination for the Teleport process.

This can be set to any of the built-in values: `stdout`, `stderr` or `syslog` to use that destination.

The value can also be set to a file path (such as `/var/log/teleport.log`) to write logs to a file. Bear in mind that a few service startup messages will still go to `stderr` for resilience.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  log:
    output: stderr
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  --set log.output=stderr
  ```
  </TabItem>
</Tabs>

### `log.format`

| Type     | Default value | Can be used in `custom` mode? | `teleport.yaml` equivalent   |
|----------|---------------|-------------------------------|------------------------------|
| `string` | `text`        | âŒ                             | `teleport.log.format.output` |

`log.format` sets the output type for the Teleport process.

Possible values are `text` (default) or `json`.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  log:
    format: json
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  --set log.format=json
  ```
  </TabItem>
</Tabs>

### `log.extraFields`

| Type   | Default value                                   | Can be used in `custom` mode? | `teleport.yaml` equivalent         |
|--------|-------------------------------------------------|-------------------------------|------------------------------------|
| `list` | `["timestamp", "level", "component", "caller"]` | âŒ                             | `teleport.log.format.extra_fields` |

`log.extraFields` sets the fields used in logging for the Teleport process.

See the [Teleport config file reference](../../reference/config.mdx) for more details on possible values for `extra_fields`.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  log:
    extraFields: ["timestamp", "level"]
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  --set "log.extraFields[0]=timestamp" \
  --set "log.extraFields[1]=level"
  ```
  </TabItem>
</Tabs>

## `affinity`

| Type     | Default value |
|----------|---------------|
| `object` | `{}`          |

[Kubernetes reference](https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity)

Kubernetes affinity to set for pod assignments.

<Admonition type="note">
  You cannot set both `affinity` and `highAvailability.requireAntiAffinity` as they conflict with each other.
</Admonition>

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: gravitational.io/dedicated
            operator: In
            values:
            - teleport
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution.nodeSelectorTerms[0].matchExpressions[0].key=gravitational.io/dedicated \
  --set affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution.nodeSelectorTerms[0].matchExpressions[0].operator=In \
  --set affinity.nodeAffinity.requiredDuringSchedulingIgnoredDuringExecution.nodeSelectorTerms[0].matchExpressions[0].values[0]=teleport
  ```
  </TabItem>
</Tabs>

## `dnsConfig`

| Type     | Default value |
|----------|---------------|
| `object` | `{}`          |

[Kubernetes reference](https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/#pod-dns-config)

Kubernetes pod DNS configuration. This value can reduce the DNS load by setting `ndots` to 0.

```yaml
dnsConfig:
  nameservers:
    - 1.2.3.4
  searches:
    - ns1.svc.cluster-domain.example
    - my.dns.search.suffix
  options:
    - name: ndots
      value: "2"
```

## `dnsPolicy`

| Type     | Default value |
|----------|---------------|
| `string` | `""`          |

[Kubernetes reference](https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/#pod-s-dns-policy)

Kubernetes pod DNS policy.

```yaml
dnsPolicy: "Default"
```

## `nodeSelector`

| Type     | Default value |
|----------|---------------|
| `object` | `{}`          |

`nodeSelector` can be used to add a map of key-value pairs to constrain the
nodes that Teleport pods will run on.

[Kubernetes reference](https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/)

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  nodeSelector:
    role: node
    region: us-east
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  --set nodeSelector.role=node \
  --set nodeSelector.region=us-east
  ```
  </TabItem>
</Tabs>

## `extraLabels.clusterRole`

| Type     | Default value |
|----------|---------------|
| `object` | `{}`          |

[Kubernetes reference](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/)

Kubernetes labels that should be applied to the `ClusterRole` created by the chart.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  extraLabels:
    clusterRole:
      app.kubernetes.io/name: teleport-kube-agent
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set extraLabels.clusterRole."app\.kubernetes\.io\/name"=teleport-kube-agent
  ```
  <Admonition type="warning" title="Escaping values">
    You must escape values entered on the command line correctly for Helm's CLI to understand them. We recommend
    using a `values.yaml` file instead to avoid confusion and errors.
  </Admonition>
  </TabItem>
</Tabs>

## `extraLabels.clusterRoleBinding`

| Type     | Default value |
|----------|---------------|
| `object` | `{}`          |

[Kubernetes reference](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/)

Kubernetes labels that should be applied to the `ClusterRoleBinding` created by the chart.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  extraLabels:
    clusterRoleBinding:
      app.kubernetes.io/name: teleport-kube-agent
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set extraLabels.clusterRoleBinding."app\.kubernetes\.io\/name"=teleport-kube-agent
  ```
  <Admonition type="warning" title="Escaping values">
    You must escape values entered on the command line correctly for Helm's CLI to understand them. We recommend
    using a `values.yaml` file instead to avoid confusion and errors.
  </Admonition>
  </TabItem>
</Tabs>

## `extraLabels.role`

| Type     | Default value |
|----------|---------------|
| `object` | `{}`          |

[Kubernetes reference](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/)

Kubernetes labels that should be applied to the `Role` created by the chart for
the Teleport pod.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  extraLabels:
    role:
      app.kubernetes.io/name: teleport-kube-agent
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set extraLabels.role."app\.kubernetes\.io\/name"=teleport-kube-agent
  ```
  <Admonition type="warning" title="Escaping values">
    You must escape values entered on the command line correctly for Helm's CLI to understand them. We recommend
    using a `values.yaml` file instead to avoid confusion and errors.
  </Admonition>
  </TabItem>
</Tabs>


## `extraLabels.roleBinding`

| Type     | Default value |
|----------|---------------|
| `object` | `{}`          |

[Kubernetes reference](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/)

Kubernetes labels that should be applied to the `RoleBinding` created by the
chart for the Teleport pod.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  extraLabels:
    roleBinding:
      app.kubernetes.io/name: teleport-kube-agent
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set extraLabels.roleBinding."app\.kubernetes\.io\/name"=teleport-kube-agent
  ```
  <Admonition type="warning" title="Escaping values">
    You must escape values entered on the command line correctly for Helm's CLI to understand them. We recommend
    using a `values.yaml` file instead to avoid confusion and errors.
  </Admonition>
  </TabItem>
</Tabs>

## `extraLabels.config`

| Type     | Default value |
|----------|---------------|
| `object` | `{}`          |

[Kubernetes reference](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/)

Kubernetes labels that should be applied to the `ConfigMap` created by the chart.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  extraLabels:
    config:
      app.kubernetes.io/name: teleport-kube-agent
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set extraLabels.config."app\.kubernetes\.io\/name"=teleport-kube-agent
  ```
  <Admonition type="warning" title="Escaping values">
    You must escape values entered on the command line correctly for Helm's CLI to understand them. We recommend
    using a `values.yaml` file instead to avoid confusion and errors.
  </Admonition>
  </TabItem>
</Tabs>

## `extraLabels.deployment`

| Type     | Default value |
|----------|---------------|
| `object` | `{}`          |

[Kubernetes reference](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/)

Kubernetes labels that should be applied to the `Deployment` or `StatefulSet` created by the chart.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  extraLabels:
    deployment:
      app.kubernetes.io/name: teleport-kube-agent
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set extraLabels.deployment."app\.kubernetes\.io\/name"=teleport-kube-agent
  ```
  <Admonition type="warning" title="Escaping values">
    You must escape values entered on the command line correctly for Helm's CLI to understand them. We recommend
    using a `values.yaml` file instead to avoid confusion and errors.
  </Admonition>
  </TabItem>
</Tabs>

## `extraLabels.pod`

| Type     | Default value |
|----------|---------------|
| `object` | `{}`          |

[Kubernetes reference](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/)

Kubernetes labels that should be applied to every `Pod` in the `Deployment` or `StatefulSet` created by the chart.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  extraLabels:
    pod:
      app.kubernetes.io/name: teleport-kube-agent
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set extraLabels.pod."app\.kubernetes\.io\/name"=teleport-kube-agent
  ```
  <Admonition type="warning" title="Escaping values">
    You must escape values entered on the command line correctly for Helm's CLI to understand them. We recommend
    using a `values.yaml` file instead to avoid confusion and errors.
  </Admonition>
  </TabItem>
</Tabs>

## `extraLabels.podDisruptionBudget`

| Type     | Default value |
|----------|---------------|
| `object` | `{}`          |

[Kubernetes reference](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/)

Kubernetes labels that should be applied to the `PodDisruptionBudget` created by the chart (if enabled).

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  extraLabels:
    podDisruptionBudget:
      app.kubernetes.io/name: teleport-kube-agent
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set extraLabels.podDisruptionBudget."app\.kubernetes\.io\/name"=teleport-kube-agent
  ```
  <Admonition type="warning" title="Escaping values">
    You must escape values entered on the command line correctly for Helm's CLI to understand them. We recommend
    using a `values.yaml` file instead to avoid confusion and errors.
  </Admonition>
  </TabItem>
</Tabs>

## `extraLabels.podSecurityPolicy`

| Type     | Default value |
|----------|---------------|
| `object` | `{}`          |

[Kubernetes reference](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/)

Kubernetes labels that should be applied to the `PodSecurityPolicy` created by the chart (if enabled).

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  extraLabels:
    podSecurityPolicy:
      app.kubernetes.io/name: teleport-kube-agent
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set extraLabels.podSecurityPolicy."app\.kubernetes\.io\/name"=teleport-kube-agent
  ```
  <Admonition type="warning" title="Escaping values">
    You must escape values entered on the command line correctly for Helm's CLI to understand them. We recommend
    using a `values.yaml` file instead to avoid confusion and errors.
  </Admonition>
  </TabItem>
</Tabs>

## `extraLabels.secret`

| Type     | Default value |
|----------|---------------|
| `object` | `{}`          |

[Kubernetes reference](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/)

Kubernetes labels that should be applied to the `Secret` created by the chart (if enabled).

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  extraLabels:
    secret:
      app.kubernetes.io/name: teleport-kube-agent
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set extraLabels.secret."app\.kubernetes\.io\/name"=teleport-kube-agent
  ```
  <Admonition type="warning" title="Escaping values">
    You must escape values entered on the command line correctly for Helm's CLI to understand them. We recommend
    using a `values.yaml` file instead to avoid confusion and errors.
  </Admonition>
  </TabItem>
</Tabs>

## `extraLabels.serviceAccount`

| Type     | Default value |
|----------|---------------|
| `object` | `{}`          |

[Kubernetes reference](https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/)

Kubernetes labels that should be applied to the `ServiceAccount` created by the
chart for the Teleport pod.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  extraLabels:
    serviceAccount:
      app.kubernetes.io/name: teleport-kube-agent
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set extraLabels.serviceAccount."app\.kubernetes\.io\/name"=teleport-kube-agent
  ```
  <Admonition type="warning" title="Escaping values">
    You must escape values entered on the command line correctly for Helm's CLI to understand them. We recommend
    using a `values.yaml` file instead to avoid confusion and errors.
  </Admonition>
  </TabItem>
</Tabs>

## `annotations.config`

| Type     | Default value | Can be used in `custom` mode? | `teleport.yaml` equivalent |
|----------|---------------|-------------------------------|----------------------------|
| `object` | `{}`          | âŒ                             | None                       |

[Kubernetes reference](https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/)

Kubernetes annotations which should be applied to the `ConfigMap` created by the chart.

<Admonition type="note">
  These annotations will not be applied in `custom` mode, as the `ConfigMap` is not managed by the chart.
  In this instance, you should apply annotations manually to your created `ConfigMap`.
</Admonition>

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  annotations:
    config:
      kubernetes.io/annotation: value
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set annotations.config."kubernetes\.io\/annotation"=value
  ```
  <Admonition type="warning" title="Escaping values">
    You must escape values entered on the command line correctly for Helm's CLI to understand them. We recommend
    using a `values.yaml` file instead to avoid confusion and errors.
  </Admonition>
  </TabItem>
</Tabs>

## `annotations.deployment`

| Type     | Default value | Can be used in `custom` mode? |
|----------|---------------|-------------------------------|
| `object` | `{}`          | âœ…                             |

[Kubernetes reference](https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/)

Kubernetes annotations which should be applied to the `Deployment` created by the chart.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  annotations:
    deployment:
      kubernetes.io/annotation: value
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set annotations.deployment."kubernetes\.io\/annotation"=value
  ```
  <Admonition type="warning" title="Escaping values">
    You must escape values entered on the command line correctly for Helm's CLI to understand them. We recommend
    using a `values.yaml` file instead to avoid confusion and errors.
  </Admonition>
  </TabItem>
</Tabs>

## `annotations.pod`

| Type     | Default value | Can be used in `custom` mode? |
|----------|---------------|-------------------------------|
| `object` | `{}`          | âœ…                             |

[Kubernetes reference](https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/)

Kubernetes annotations which should be applied to each `Pod` created by the chart.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  annotations:
    pod:
      kubernetes.io/annotation: value
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set annotations.pod."kubernetes\.io\/annotation"=value
  ```
  <Admonition type="warning" title="Escaping values">
    You must escape values entered on the command line correctly for Helm's CLI to understand them. We recommend
    using a `values.yaml` file instead to avoid confusion and errors.
  </Admonition>
  </TabItem>
</Tabs>

## `annotations.serviceAccount`

| Type     | Default value | Can be used in `custom` mode? |
|----------|---------------|-------------------------------|
| `object` | `{}`          | âœ…                             |

[Kubernetes reference](https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/)

Kubernetes annotations which should be applied to the `ServiceAccount` created by the chart.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  annotations:
    serviceAccount:
      kubernetes.io/annotation: value
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set annotations.serviceAccount."kubernetes\.io\/annotation"=value
  ```
  <Admonition type="warning" title="Escaping values">
    You must escape values entered on the command line correctly for Helm's CLI to understand them. We recommend
    using a `values.yaml` file instead to avoid confusion and errors.
  </Admonition>
  </TabItem>
</Tabs>

## `extraVolumes`

| Type   | Default value | Can be used in `custom` mode? |
|--------|---------------|-------------------------------|
| `list` | `[]`          | âœ…                             |

[Kubernetes reference](https://kubernetes.io/docs/concepts/storage/volumes/)

A list of extra Kubernetes `Volumes` which should be available to any `Pod` created by the chart. These volumes
will also be available to any `initContainers` configured by the chart.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  extraVolumes:
  - name: myvolume
    secret:
      secretName: mysecret
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set "extraVolumes[0].name=myvolume" \
  --set "extraVolumes[0].secret.secretName=mysecret"
  ```
  </TabItem>
</Tabs>

## `extraArgs`

| Type   | Default value |
|--------|---------------|
| `list` | `[]`          |

A list of extra arguments to pass to the `teleport start` command when running a Teleport Pod.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  extraArgs:
  - "--debug"
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set "extraArgs={--debug}"
  ```
  </TabItem>
</Tabs>

## `extraEnv`

| Type   | Default value |
|--------|---------------|
| `list` | `[]`          |

[Kubernetes reference](https://kubernetes.io/docs/tasks/inject-data-application/define-environment-variable-container/)

A list of extra environment variables to be set on the main Teleport container.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  extraEnv:
  - name: HTTPS_PROXY
    value: "http://username:password@my.proxy.host:3128"
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set "extraEnv[0].name=HTTPS_PROXY" \
  --set "extraEnv[0].value=\"http://username:password@my.proxy.host:3128\""
  ```
  </TabItem>
</Tabs>

## `extraVolumeMounts`

| Type   | Default value | Can be used in `custom` mode? |
|--------|---------------|-------------------------------|
| `list` | `[]`          | âœ…                             |

[Kubernetes reference](https://kubernetes.io/docs/concepts/storage/volumes/)

A list of extra Kubernetes volume mounts which should be mounted into any `Pod` created by the chart. These volume
mounts will also be mounted into any `initContainers` configured by the chart.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  extraVolumeMounts:
  - name: myvolume
    mountPath: /path/to/mount/volume
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set "extraVolumeMounts[0].name=myvolume" \
  --set "extraVolumeMounts[0].path=/path/to/mount/volume"
  ```
  </TabItem>
</Tabs>

## `imagePullPolicy`

| Type     | Default value  | Can be used in `custom` mode? |
|----------|----------------|-------------------------------|
| `string` | `IfNotPresent` | âœ…                             |

[Kubernetes reference](https://kubernetes.io/docs/concepts/containers/images/#updating-images)

Allows the `imagePullPolicy` for any pods created by the chart to be overridden.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  imagePullPolicy: Always
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set imagePullPolicy=Always
  ```
  </TabItem>
</Tabs>

## `initContainers`

| Type   | Default value | Can be used in `custom` mode? |
|--------|---------------|-------------------------------|
| `list` | `[]`          | âœ…                             |

[Kubernetes reference](https://kubernetes.io/docs/concepts/workloads/pods/init-containers/)

A list of `initContainers` which will be run before the main Teleport container in any pod created by the chart.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  initContainers:
  - name: teleport-init
    image: alpine
    args: ['echo test']
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set "initContainers[0].name=teleport-init" \
  --set "initContainers[0].image=alpine" \
  --set "initContainers[0].args={echo test}"
  ```
  </TabItem>
</Tabs>

## `resources`

| Type     | Default value | Can be used in `custom` mode? |
|----------|---------------|-------------------------------|
| `object` | `{}`          | âœ…                             |

[Kubernetes reference](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/)

Resource requests/limits which should be configured for each container inside the pod. These resource limits
will also be applied to `initContainers`.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  resources:
    requests:
      cpu: 1
      memory: 2Gi
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set resources.requests.cpu=1 \
  --set resources.requests.memory=2Gi
  ```
  </TabItem>
</Tabs>

## `tolerations`

| Type   | Default value | Can be used in `custom` mode? |
|--------|---------------|-------------------------------|
| `list` | `[]`          | âœ…                             |

[Kubernetes reference](https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/)

Kubernetes Tolerations to set for pod assignment.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  tolerations:
  - key: "dedicated"
    operator: "Equal"
    value: "teleport"
    effect: "NoSchedule"
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set tolerations[0].key=dedicated \
  --set tolerations[0].operator=Equal \
  --set tolerations[0].value=teleport \
  --set tolerations[0].effect=NoSchedule
  ```
  </TabItem>
</Tabs>

## `probeTimeoutSeconds`

| Type      | Default value |
|-----------|---------------|
| `integer` | `1`           |

[Kubernetes reference](https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/)

Kubernetes timeouts for the liveness and readiness probes.

<Tabs>
  <TabItem label="values.yaml">
  ```yaml
  probeTimeoutSeconds: 5
  ```
  </TabItem>
  <TabItem label="--set">
  ```code
  $ --set probeTimeoutSeconds=5
  ```
  </TabItem>
</Tabs>
