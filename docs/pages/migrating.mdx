---
title: Migrating from Teleport Enterprise (self-hosted) to Teleport Enterprise (cloud-hosted)
description: How to migrate from Teleport Enterprise (self-hosted) to Teleport Enterprise (cloud-hosted).
h1: Migrate to Teleport Enterprise (cloud-hosted)
---

This guide outlines the steps required to migrate your Teleport deployment from a Teleport Enterprise (self-hosted) Cluster to Teleport Enterprise (cloud-hosted). 
The migration process involves transferring configurations, migrating Teleport agents, and ensuring a successful transition with good performance on Teleport Enterprise (cloud-hosted).


## Prerequisites

- An existing Teleport Enterprise (self-hosted) Cluster


## Next Steps

### Deploy your Teleport Enterprise (cloud-hosted) Cluster

- Determine the `teleport.sh` subdomain you would like to use for your new Teleport Enterprise (cloud-hosted) tenant. 
  - If your existing Teleport Enterprise (self-hosted) license dashboard is already using your desired subdomain, you can contact Teleport Support to free up the domain for re-use.

- Reach out to your Account Management team to setup your Teleport Enterprise (cloud-hosted) tenant, [Contact Us](https://goteleport.com/signup/enterprise/). For more information, you may refer to our documentation on [signing up for a Teleport Enterprise account](https://goteleport.com/docs/choose-an-edition/teleport-cloud/introduction/)

- Ensure you are running Teleport enterprise agents with versions which are lower than the Teleport Enterprise (cloud-hosted) tenant version.
  - To check the versions of your Teleport Enterprise agents, you can use the `tctl` command to list the inventory of connected agents and their version. 

```code  
tctl inventory ls --older-than=<version>
```

- Validate connectivity to both the newly deployed Teleport Enterprise (cloud-hosted) Cluster and your existing Teleport Enterprise (self-hosted) Cluster. You should be able to connect to both Teleport Clusters and execute `tctl` commands using your current credentials. To verify connectivity, follow these steps:
  - Sign in to your Teleport Cluster using `tsh login`.
  - Verify connectivity by running `tctl status`

</Details>

<Admonition
  type="tip"
  title="Note"
>

  Ensure that the recovery codes displayed when you first set up your Teleport Enterprise (cloud-hosted) tenant are saved securely, so as not to lose access. For your security, Teleport Support cannot assist with resetting passwords or recovering lost credentials.


</Admonition>

- Subscribe to the [Teleport Enterprise status website](https://status.teleport.sh/) to stay current on any issues impacting Teleport Enterprise (cloud-hosted) performance.

### Validate connectivity  

To check that you can connect to your Teleport Enterprise (cloud-hosted) tenant, using the `tsh` command-line tool sign in with `tsh login`, then verify that you can run `tctl` commands using your current credentials.
For example:

```code
$ tsh login --proxy=example.teleport.sh --user=admin@example.com
$ tsh status && tctl status
```

If you can connect to the Cluster and run the `tctl status` command, you can use your current credentials to run subsequent `tctl` commands from your workstation.


### Migrate Teleport Configurations.

Migrating to Teleport Enterprise (cloud-hosted) involves transferring essential resource configurations from your Teleport Enterprise (self-hosted) Cluster to Teleport Enterprise (cloud-hosted). Teleport uses YAML configuration for these resources, hence, it is required to grab a backup of the dynamic resource configurations from the existing Teleport Enterprise (self-hosted) Cluster and restore the resource on Teleport Enterprise (cloud-hosted). These resources include:   

- Roles
- Local users
- SSO authentication connectors

Review the [dynamic resources](https://goteleport.com/docs/reference/resources/) list to see if any other resources need to be migrated.  Some common dynamic resources includes:
- `windows_desktop`
- `apps`
- `dbs`
- `login_rule`

</Details>

<Admonition
  type="tip"
  title="Note"
>

  Trusted Clusters are not supported on Teleport Enterprise (cloud-hosted).  You will not be able to migrate trusted Cluster resources.

</Admonition>


To achieve this:
- Log in to your existing Teleport Enterprise (self-hosted) Cluster and export a collection of the above-mentioned dynamic resource configuration using the `tctl` administrative tool.  An example is shown below:

```code
$ tsh login --proxy=teleport.example.com --user=admin@example.com
$ tctl get roles > roles.yaml 
$ tctl get users > users.yaml 
```

- Once you have the resource configuration file from the above, proceed to log in to your Teleport Enterprise (cloud-hosted) tenant with an admin user and create the resources from the exported files:

```code
$ tsh login --proxy=example.teleport.sh --user=admin@example.com
$ tctl create -f roles.yaml
$ tctl create -f user.yaml
```

For your SSO auth connector, most SSO integrations only work for a single configured endpoint. It is recommended to create a separate SSO connector in your Identity Provider specifically for the Teleport Enterprise (cloud-hosted) endpoint, and configure a new Auth Connector in the Teleport Enterprise (cloud-hosted) tenant.


### Migrate Teleport Agents

To ensure a successful migration process across your infrastructure, start by cataloging the various services you're managing with Teleport. The following resources should be considered for migration:

 - Teleport Agents (SSH, Kubernetes, Databases, Applications, Desktops)
 - Machine ID Bots
 - Access Request Plugins

The following procedure is required to successfully migrate your Teleport agents:

- Log in to your Teleport Enterpise (cloud-hosted) tenant, You'll need to authenticate to access your resources and management interfaces.

- Obtain a valid join token: We recommend using a [Delegated Join Method](https://goteleport.com/docs/reference/join-methods/#delegated-join-methods)

If using ephemeral tokens, ensure you specify the appropriate token type to match the Teleport services. Token types can include `node`, `app`, `kube`, `db`, `windowsdesktop` and others depending on the service you wish to join to your Teleport Cluster.

In the following example, a new token is created with the TTL of fifteen minutes:

```code
$ tctl tokens add --type node,app,db --ttl 15m
```

In this command, we assigned the token the `node`, `app` and `db` type, indicating that it will allow an agent to join which is running the Teleport `ssh_service`, `db_service` and `app_service`.

Copy the token so you can use it later in this guide.

- Stop the Teleport service on the agent (if applicable)

- Update the `proxy_server` or `auth_servers` field in the agent configuration file to point to the address of your Teleport Enterprise (cloud-hosted) Cluster. By default, the configuration is located in the `/etc/teleport.yaml` directory.

```yaml
version: v3
teleport:
   proxy_server: example.teleport.sh:443
```

- Update the `auth_token` or `join_params.token_name` field with the newly generated token.

```yaml
teleport:
  join_params:
    method: token
    token_name: new-token-goes-here
```

- Delete the local agent cache to force the agent to rejoin the new Teleport Enterprise (cloud-hosted) Cluster. By default, the data is located in the  `/var/lib/teleport` directory:

```code
rm -rf /var/lib/teleport
```

- Start the Teleport process on each agent or recycle the pod to apply the new configuration. This will cause the agents to re-register with the Teleport Enterprise (cloud-hosted) Cluster and obtain new certificates signed by the Teleport Enterprise (cloud-hosted) Cluster's certificate authority.

As new services come online, they start sending heartbeat requests every few seconds to the Auth Service. This allows users to explore Cluster membership. 

Note: ​​Migration of agents can be done all at once or gradually, depending on your business requirements. If running Teleport at scale, you'll generally want to leverage the use of a configuration management tool to automate and streamline the process of carrying out the actions involved in migrating agent configurations. 

### Verify end User Access and performance

Once the migration is complete, validate that the resources are present in the Teleport Cluster and verify their status and connectivity to ensure they are properly registered and available for connections. You can either check via the Web UI, or use `tctl` to get a list of all resources and verify their registration and status. 

For example, to list all nodes registered with the Teleport Cluster, you can run the command below

```
tctl nodes ls
```

Similarly, to list all other registered resources, you can run the commands below:


list all registered Kubernetes Clusters
```
tctl kube ls
```

List all registered Databases

```
tctl db ls
```

List all registred Applications

```
tctl apps ls
```

List all registred Windows Desktops

```
tctl get windows_desktop

```

These `tctl` commands will show you the resources registered within your Teleport Cluster, and you can verify their availability for connections.

- Ensure that end users have the expected SSO access to your infrastructure and workflow.

Additionally, establish break glass access procedures to ensure access to infrastructure in case of Teleport Enterprise (cloud-hosted) unavailability.
An example break-glass option for infrastructure admins for temporary access in case of an outage:

- Run OpenSSH with a limited key following our best practices on [How to SSH properly](https://goteleport.com/blog/how-to-ssh-properly/).
  - We recommend configuring systemd to start OpenSSH for 5 minutes at boot, then shut it down. The master keys should be stored in a secure vault. To break the glass, obtain the master key, reboot the server, and connect using an OpenSSH client within 5 minutes.

### Conclusion

Migrating from a Teleport Enterprise (self-hosted) deployment to Teleport Enterprise (cloud-hosted) offers scalability, reliability, and ease of management. By following the steps outlined in this guide, you can transition your Teleport Enterprise (self-hosted) deployment to Teleport Enterprise (cloud-hosted) successfully while ensuring minimal disruption to your operations.
