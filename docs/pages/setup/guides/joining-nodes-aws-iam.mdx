---
title: Joining Nodes via AWS IAM Role
description: Use the IAM join method to add nodes to your Teleport cluster on AWS
---

This guide will explain how to use the **IAM join method** to configure Teleport
nodes and Proxies to join your Teleport cluster without sharing any secrets when
they are running in AWS.

The IAM join method is available in Teleport 8.3+. It is available to any
Teleport node or Proxy running anywhere with access to IAM credentials, such as
an EC2 instance with an attached IAM role. No specific permissions or IAM policy
is required: an IAM role with no attached policies is sufficient. No IAM
credentials are required on the Teleport Auth Service.

<Details 
scope={["oss", "enterprise"]} 
scopeOnly
opened
title="Other AWS node joining methods"
>

There are two additional methods you can use to join your nodes to a Teleport
cluster.

The **EC2 join method** is available in self-hosted verisons of Teleport 7.3+.
It is available to any Teleport node or Proxy running on an EC2 instance. Only
one Teleport node or Proxy per EC2 instance may use the EC2 join method.

IAM credentials with `ec2:DescribeInstances` permissions are required on
your Teleport Auth Service. No IAM credentials are required on the nodes or
Proxies.

You can also configure nodes running in AWS to join a cluster via **secret tokens**,
which is useful when you don't want to rely on AWS-specific APIs.
Read more in the following guide:
[Adding nodes to the cluster](../admin/adding-nodes.mdx)

</Details>
<Details 
scope={["cloud"]} 
scopeOnly
opened
title="Another AWS node joining method"
>

You can also configure nodes running in AWS to join a cluster via **secret tokens**,
which is useful when you don't want to rely on AWS-specific APIs.
Read more in the following guide:
[Adding nodes to the cluster](../admin/adding-nodes.mdx)

</Details>

<Notice type="warning" scope={["oss", "enterprise"]}>

The IAM join method will not work if TLS is terminated at a load balancer in
front of your Teleport Proxy Service unless the node using this method is
connecting directly to the Auth Service.

The IAM join method is currently not supported in the AWS China or GovCloud
partitions.

</Notice>
<Notice type="warning" scope={["cloud"]}>

The IAM join method is currently not supported in the AWS China or GovCloud
partitions.

</Notice>

## Prerequisites

<Tabs>
<TabItem scope={["oss"]} label="Self-Hosted">

- A running Teleport cluster. For details on how to set this up, see [Getting
  Started on a Linux Server](../../getting-started/linux-server.mdx).

- The `tctl` admin tool version >= (=teleport.version=).

  ```code
  $ tctl version
  # Teleport v(=teleport.version=) go(=teleport.golang=)
  ```

  See [Installation](../../installation.mdx) for details.

- An AWS EC2 instance to act as a Teleport node, with the Teleport binary
  installed.

</TabItem>
<TabItem
  scope={["enterprise"]} label="Enterprise">

- A running Teleport cluster. For details on setting this up, see our
  [Enterprise getting started guide](../../enterprise/getting-started.mdx).

- The `tctl` admin tool version >= (=teleport.version=), which you can download
  by visiting the
  [customer portal](https://dashboard.gravitational.com/web/login).

  ```code
  $ tctl version
  # Teleport v(=teleport.version=) go(=teleport.golang=)
  ```

- An AWS EC2 instance to act as a Teleport node, with the Teleport binary
  installed.

</TabItem>
<TabItem scope={["cloud"]}
  label="Cloud">

- A Teleport Cloud account. If you do not have one, visit the
  [sign up page](https://goteleport.com/signup/) to begin your free trial.

- The Enterprise version of the `tctl` admin tool. To download this, visit
the [customer portal](https://dashboard.gravitational.com/web/login).

  ```code
  $ tctl version
  # Teleport v(=teleport.version=) go(=teleport.golang=)
  ```

- An AWS EC2 instance to act as a Teleport node, with the Teleport binary
  installed.

</TabItem>
</Tabs>

(!docs/pages/includes/tctl.mdx!)

## Step 1/4. Set up AWS IAM credentials
Every node or Proxy using the IAM method to join your Teleport cluster needs AWS
IAM credentials in order to call the `sts:GetCallerIdentity` API. No specific
IAM policy or permissions are needed. Any IAM user or role can call this API.

If running your node on an EC2 instance, it is sufficient to attach any IAM
role to the instance. To attach an IAM role from the EC2 dashboard, select
`Actions > Security > Modify IAM role`.

You can also provide the IAM credentials to Teleport through a shared
configuration file or environment variables. For details, see the following guide:

[Specifying Credentials](https://aws.github.io/aws-sdk-go-v2/docs/configuring-sdk/#specifying-credentials)

## Step 2/4. Create the AWS node joining token
Under the hood, nodes will prove that they are running in your AWS account by
sending a pre-signed `sts:GetCallerIdentity` request to the Teleport Auth Server. The
node's identity must match an allow rule configured in your AWS node joining
token.

Create the following `token.yaml` with an `allow` rule specifying your AWS
account and the ARN that your node's identity must match.

```
# token.yaml
kind: token
version: v2
metadata:
  # the token name is not a secret because instances must prove that they are
  # running in your AWS account to use this token
  name: iam-token
  # set a long expiry time, the default for tokens is only 30 minutes
  expires: "3000-01-01T00:00:00Z"
spec:
  # use the minimal set of roles required
  roles: [Node]

  # set the join method allowed for this token
  join_method: iam

  allow:
  # specify the AWS account which nodes may join from
  - aws_account: "111111111111"
  # multiple allow rules are supported
  - aws_account: "222222222222"
  # aws_arn is optional and allows you to restrict the IAM role of joining nodes
  - aws_account: "333333333333"
    aws_arn: "arn:aws:sts::333333333333:assumed-role/teleport-node-role/i-*"
```

The optional `aws_arn` field in the allow rules supports wildcard characters:
- `*` to match any combination of characters
- `?` to match any single character

See the
[IAM docs](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies_elements_resource.html)
for more details on the ARN format.

You can check what your AWS identity looks like by running
`aws sts get-caller-identity` on the
[AWS CLI](https://aws.amazon.com/cli/).

Run `tctl create token.yaml` to create the token.

## Step 3/4. Configure your nodes
The IAM join method can be used for Teleport services running the SSH, Proxy,
Kubernetes, Application, or Database Service.

Configure your Teleport node with a custom `teleport.yaml` file. Use the
`join_params` section with `token_name` matching your token created in Step 2
and `method: iam` as shown in the following example config:

```
# /etc/teleport.yaml
teleport:
  join_params:
    token_name: iam-token
    method: iam
  auth_servers:
  - https://teleport.example.com:443
ssh_service:
  enabled: yes
auth_service:
  enabled: no
proxy_service:
  enabled: no
```

## Step 4/4. Launch your Teleport node

Start Teleport on the node and confirm that it is able to connect to and join
your cluster. You're all set!